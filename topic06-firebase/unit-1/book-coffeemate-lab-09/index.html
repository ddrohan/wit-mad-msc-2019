<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css"
          type="text/css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css"
          rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html"> Intro, Database, Authentication & Storage  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Lab-09">
          Lab-09
        </a>
      
        <a class="item" data-tab="01">
          01
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="03">
          03
        </a>
      
        <a class="item" data-tab="04">
          04
        </a>
      
        <a class="item" data-tab="05">
          05
        </a>
      
        <a class="item" data-tab="06">
          06
        </a>
      
        <a class="item" data-tab="07">
          07
        </a>
      
        <a class="item" data-tab="08">
          08
        </a>
      
        <a class="item" data-tab="09">
          09
        </a>
      
        <a class="item" data-tab="10">
          10
        </a>
      
        <a class="item" data-tab="Solution">
          Solution
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic01-overview-and-tools/unit-1/book-coffeemate-lab-01/index.html">Lab-01 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic02-ui-design/unit-1/book-coffeemate-lab-02/index.html">Lab-02 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic02-ui-design/unit-1/book-coffeemate-lab-03/index.html">Lab-03 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic02-ui-design/unit-2/book-coffeemate-lab-04/index.html">Lab-04 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic03-persistence/unit-1/book-coffeemate-lab-05-a/index.html">Lab-05-a </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic03-persistence/unit-1/book-coffeemate-lab-05-b/index.html">Lab-05-b </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic04-networking/unit-1/book-coffeemate-lab-06-a/index.html">Lab-06-a </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic04-networking/unit-1/book-coffeemate-lab-06-b/index.html">Lab-06-b </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic05-google-services/unit-1/book-coffeemate-lab-07/index.html">Lab-07 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic05-google-services/unit-1/book-coffeemate-lab-08/index.html">Lab-08 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic06-firebase/unit-1/book-coffeemate-lab-09/index.html">Lab-09 </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Lab-09">
            <h1>Objectives</h1>
<p>This lab &#39;takes a step back to step forward&#39;, in that we refactor a previous version (4.0) of our Case Study <b>CoffeeMate</b> and introduce <strong>Firebase Support</strong> via <strong>Firebase Authentication</strong> and a <strong>Realtime Database</strong> in version <b>CoffeeMate.9.0</b></p>

          </div>
        
          <div class="ui tab segment lab" data-tab="01">
            <h1>Setup - Adding Firebase Support to your Project Part 1</h1>
<p>It can be quite difficult to try and &#39;bolt on&#39; Firebase to an Android App, but lucky for us, Android Studio has an <strong>Assistant</strong> that can do a lot of the heavy lifting for us. We&#39;ll begin with a version of CoffeeMate which includes a number of the Google APis that we need which you can download here - <a href="archives/CoffeeMate.8.0.zip">CoffeeMate.8.0</a> or you can continue on with you own version, if you&#39;ve completed all the labs thus far.</p>
<p>As always, It&#39;s probably still a good idea to run the App and confirm that the app (or your 8.0 version app) is configured properly and (still) running.</p>
<p>You might also want to rename the app to <strong>CoffeeMate.9.0</strong>.</p>
<p>On completion of this lab, you will be able to do the following:</p>
<ul>
<li><p>Create/Import a new project to your Firebase Console (found <a href="https://console.firebase.google.com">here</a>) and configure your project as required</p>
</li>
<li><p>Add Firebase Authentication (including Google Sign-In)</p>
</li>
<li><p>Add CRUD (Create Retrieve Update Delete) functionality via your Firebase Realtime Database</p>
</li>
</ul>
<p>The following steps will help you achieve this, so before we can do anything with Firebase, let&#39;s use the <strong>Assistant</strong> to add <strong>Firebase Support</strong> to CoffeeMate.</p>
<p>Launch the Assistant through Tools-&gt;Firebase</p>
<p><img src="img/firebase1.png" alt=""></p>
<p>and you get</p>
<p><img src="img/firebase2.png" alt=""></p>
<p>Expand <strong>Authentication</strong></p>
<p><img src="img/firebase3.png" alt=""></p>
<p>and select <strong>Connect to Firebase</strong></p>
<p><img src="img/firebase4.png" alt=""></p>
<p>This will then Launch a Browse directing you to sign in to Android Studio (with your Google Account)</p>
<p><img src="img/firebase5.png" alt=""></p>
<p>and</p>
<p><img src="img/firebase6.png" alt=""></p>
<p>so Allow that and you are then directed back to Android Studio, to complete the process.</p>
<p><img src="img/firebase7.png" alt=""></p>
<p>Next, you&#39;re asked to <strong>Create or Choose a Firebase Project</strong></p>
<p><img src="img/firebase9.png" alt=""></p>
<p>I&#39;m choosing &#39;CoffeeMate FullFat Server&#39; here :)</p>
<p><img src="img/firebase10.png" alt=""></p>
<p>If you get the following error, you&#39;ll need to rename your package (ie.cm if you&#39;ve followed the labs) to something else</p>
<p><img src="img/firebase11.png" alt=""></p>
<p><strong>AND</strong> make sure you rename it in your gradle file also (Android Studio won&#39;t do this for you)</p>
<p><img src="img/firebase12.png" alt=""></p>
<p><strong><em>AND</em></strong> :) also make sure you update your Google Maps API credentials to include this new package, otherwise your maps will stop working</p>
<p><img src="img/apikey.png" alt=""></p>
<p>If everything goes as planned, you&#39;ll get</p>
<p><img src="img/firebase13.png" alt=""></p>
<p>and then</p>
<p><img src="img/firebase16.png" alt=""></p>
<p>and via the Assistant</p>
<p><img src="img/firebase17.png" alt=""></p>
<p>If you get this error, just try and connect again</p>
<p><img src="img/firebase14.png" alt=""></p>
<p>and you&#39;ll get this</p>
<p><img src="img/firebase15.png" alt=""></p>
<p>Next step involves the Firebase Console</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>Setup - Adding Firebase Support to your Project Part 2</h1>
<p>At this stage we have CoffeeMate connected to Firebase, so we&#39;ll now configure our Firebase Console for adding Authentication to our app.</p>
<p>First, visit <a href="http://firebase.google.com"><a href="http://firebase.google.com">http://firebase.google.com</a></a>
<img src="img/console1.png" alt="">
login into your Console, and confirm you can see your <strong>CoffeeMate FullFat Server</strong> Firebase Project (or whatever you called it)
<img src="img/console3.png" alt="">
Select the project
<img src="img/console4.png" alt="">
and our connected app and <strong>Continue SDK setup</strong>
<img src="img/console5.png" alt="">
Download the <strong>google-services.json</strong> file
<img src="img/console6.png" alt="">
and <strong>Add Firebase SDK</strong>
<img src="img/console7.png" alt="">
<img src="img/console8.png" alt="">
<strong>NOTE: If your project fails to sync, revert back to the previous version of google-services</strong>
<img src="img/auth11b.png" alt="">
Once you run your app to verify installation
<img src="img/console9.png" alt="">
you can proceed to setting up Authentication on the console</p>
<p><img src="img/auth3.png" alt=""></p>
<p>Choose <strong>Authentication</strong></p>
<p><img src="img/auth5.png" alt=""></p>
<p>and <strong>Set up sign-in method</strong></p>
<p><img src="img/auth6.png" alt=""></p>
<p>We&#39;ll <strong>Enable</strong> just &#39;Email/Password&#39; and &#39;Google&#39; here</p>
<p><img src="img/auth7.png" alt=""></p>
<p><img src="img/auth8.png" alt=""></p>
<p><img src="img/auth9.png" alt=""></p>
<p><img src="img/auth10.png" alt=""></p>
<p>Back in Android Studio when you choose to <strong>Add Firebase Authentication</strong> to your app, you&#39;re prompted to accept the following changes, but at the time of writing (Dec 2018) this doesn&#39;t work :)</p>
<p><img src="img/auth11.png" alt=""></p>
<p>so choose the following instead</p>
<p><img src="img/auth11b.png" alt="">
and
<img src="img/auth11a.png" alt=""></p>
<p>Build your app again to confirm everything checks out and we&#39;re now ready to add the functionality.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="03">
            <h1>Signing In with Firebase Authentication</h1>
<p>First of all, make sure you have your Firebase Project set up and you&#39;ve added your existing CoffeeMate project to it</p>
<p>Some useful links</p>
<p><a href="https://console.firebase.google.com/u/0/">https://console.firebase.google.com/u/0/</a></p>
<p><a href="https://console.cloud.google.com/home/dashboard">https://console.cloud.google.com/home/dashboard</a></p>
<p>For this Lab we&#39;ll be using Google Sign-In Authentication with Firebase, so visit your firebase console again here <a href="https://console.firebase.google.com">https://console.firebase.google.com</a> and confirm you&#39;ve enabled the required Authentication.</p>
<p> We&#39;ll be using a lot of this <a href="https://firebase.google.com/docs/auth/android/google-signin">https://firebase.google.com/docs/auth/android/google-signin</a> for reference on this step.</p>
<p>Now, open your <strong>Login.java</strong> and update your <strong>GoogleSignInOptions</strong> object to &#39;requestIDToken()&#39; like so</p>
<pre><code class="lang-java">app.mGoogleSignInOptions = new GoogleSignInOptions
                .Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                .requestIdToken(getString(R.string.default_web_client_id))
                .requestEmail()
                .requestProfile()
                .build();</code></pre>
<p><strong>NOTE: You&#39;ll need to have already added your &#39;google-services.json&#39; from your console and have stored it in the correct location to reference the client id</strong></p>
<p>Alternatively, You can find your web client id here under <strong>Project settings</strong></p>
<p><img src="img/webkey1.png" alt=""></p>
<p><img src="img/webkey2.png" alt=""></p>
<p><img src="img/webkey3.png" alt=""></p>
<p>Next, add the following properties to your <strong>CoffeeMateApp</strong></p>
<pre><code class="lang-java">public FirebaseAuth mFirebaseAuth;
public FirebaseUser mFirebaseUser;</code></pre>
<p>and bring in the following to your <code>Login</code></p>
<pre><code class="lang-java">private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {

       Log.v(TAG, &quot;firebaseAuthWithGoogle:&quot; + acct.getId());

       AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);
       app.mFirebaseAuth.signInWithCredential(credential)
               .addOnCompleteListener(this, new OnCompleteListener&lt;AuthResult&gt;() {
                   @Override
                   public void onComplete(@NonNull Task&lt;AuthResult&gt; task) {
                       Log.v(TAG, &quot;signInWithCredential:onComplete:&quot; + task.isSuccessful());
                       validateFirebaseUser();
                       // If sign in fails, display a message to the user. If sign in succeeds
                       // the auth state listener will be notified and logic to handle the
                       // signed in user can be handled in the listener.
                       if (!task.isSuccessful()) {
                           Log.v(TAG, &quot;signInWithCredential&quot;, task.getException());
                           Toast.makeText(Login.this, &quot;Authentication failed.&quot;,
                                   Toast.LENGTH_SHORT).show();
                       }
                       else
                           startHomeScreen();
                   }
               });
   }

    private void validateFirebaseUser()
    {
        Log.v(TAG,&quot;Calling validateFirebaseUser() &quot; );
        if(app.mFirebaseUser == null)
            app.mFirebaseUser = FirebaseAuth.getInstance().getCurrentUser();

        final String userName = app.mFirebaseUser.getDisplayName();
        final String userId = app.mFirebaseUser.getUid();
        final String email = app.mFirebaseUser.getEmail();

        Log.v(TAG,&quot;Validating Firebase User Details for: &quot; + app.mFirebaseUser.getEmail());

    }</code></pre>
<p>Add this to your <strong>onCreate()</strong></p>
<pre><code class="lang-java">app.mFirebaseAuth = FirebaseAuth.getInstance();</code></pre>
<p>and try and work out where you should be calling</p>
<pre><code class="lang-java">firebaseAuthWithGoogle(...)</code></pre>
<p>Run your app and keep track of the Logs in Android Studio to verify Firebase Authentication.</p>
<p>If everything is configured correctly, you should now be seeing a new user on your console</p>
<p><img src="img/firebaseauth1.png" alt=""></p>
<p> and going forward</p>
<p><img src="img/firebaseauth2.png" alt=""></p>
<p>  and</p>
<p><img src="img/firebaseauth3.png" alt=""></p>
<p>And for completeness you should probably sign out your current user from Firebase, whenever they log out of the app using</p>
<pre><code class="lang-java">FirebaseAuth.getInstance().signOut();
app.mFirebaseUser = null;
Log.v(&quot;coffeemate&quot;, &quot;User Logged out of Firebase&quot;);</code></pre>
<p>The next step will involving Adding coffees to our Firebase Realtime database.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="04">
            <h1>Firebase CRUD - Add / Verify a User</h1>
<p>Before you go any further, here&#39;s where we&#39;re at so far</p>
<ul>
<li><a href="archives/CoffeeMate.9.0.sofar.zip">CoffeeMate.9.0.sofar</a></li>
</ul>
<p>and remember to retain your own <strong>google-services.json</strong> file and <strong>google maps api key</strong> (as this archive doesn&#39;t contain either)</p>
<p>First thing to do is add <strong>Realtime Database</strong> support to your project via the <strong>Assistant</strong>, like so</p>
<p><img src="img/db1.png" alt=""></p>
<p>and</p>
<p><img src="img/db2.png" alt=""></p>
<p>and if you accept the following changes</p>
<p><img src="img/db3.png" alt=""></p>
<p>make sure to change it to</p>
<p><img src="img/db4.png" alt=""></p>
<p><strong>(Maybe it&#39;s fixed currently, but at the time of writing (Dec 2018) this is still an issue)</strong></p>
<p>Now, in order to perform any operation on the database, whether it be read or write (or update or delete), you need to get a reference to the database first.
the code that follows gives you a reference to the database JSON top node (and a lot more). From here you need to use the child node names to traverse further. And to keep our code as reusable as possible, we&#39;ll introduce a few new classes to manage our Firebase database calls (similar to what we did way back in our SQLite lab).</p>
<p>First, introduce the following into your <strong>models</strong> package, so that we can associate specific users with their own coffees.</p>
<pre><code class="lang-java">public class User {

    public String userId;
    public String userName;
    public String userEmail;
    public String userProfilePic;

    public User(){
        // Default constructor required for calls to DataSnapshot.getValue(User.class)
    }

    public User(String userId, String userName, String userEmail, String userProfilePic ){
        this.userId = userId;
        this.userName = userName;
        this.userEmail = userEmail;
        this.userProfilePic = userProfilePic;
    }
}</code></pre>
<p>Now, create a new class called <strong>FirebaseManager</strong> and place it in the same api package we have our <strong>VolleyListener</strong> class.</p>
<p>Add the following properties</p>
<pre><code class="lang-java">  private static final String TAG = &quot;coffeemate&quot;;
  public DatabaseReference mFirebaseDatabase;
  public static String mFirebaseUserId;</code></pre>
<p>and method (for the moment)</p>
<pre><code class="lang-java">public void open() {
      //Set up local caching
      FirebaseDatabase.getInstance().setPersistenceEnabled(true);
      //Bind to remote Firebase Database
      mFirebaseDatabase = FirebaseDatabase.getInstance().getReference();
      Log.v(TAG, &quot;Database Connected :&quot; + mFirebaseDatabase);
  }</code></pre>
<p>Then, open up your <strong>Login</strong> activity and update these existing methods</p>
<pre><code class="lang-java">private void firebaseAuthWithGoogle(GoogleSignInAccount acct) {

       Log.v(TAG, &quot;firebaseAuthWithGoogle:&quot; + acct.getEmail());

       AuthCredential credential = GoogleAuthProvider.getCredential(acct.getIdToken(), null);
       app.mFirebaseAuth.signInWithCredential(credential)
               .addOnCompleteListener(this, new OnCompleteListener&lt;AuthResult&gt;() {
                   @Override
                   public void onComplete(@NonNull Task&lt;AuthResult&gt; task) {
                       Log.v(TAG, &quot;signInWithCredential:onComplete:&quot; + task.isSuccessful());
                       validateFirebaseUser();
                       // If sign in fails, display a message to the user. If sign in succeeds
                       // the auth state listener will be notified and logic to handle the
                       // signed in user can be handled in the listener.
                       if (!task.isSuccessful()) {
                           Log.v(TAG, &quot;signInWithCredential&quot;, task.getException());
                           Toast.makeText(Login.this, &quot;Authentication failed.&quot;,
                                   Toast.LENGTH_SHORT).show();
                       }
                   }
               });
   }

   public void validateFirebaseUser() {
        if(app.mFirebaseUser == null)
            app.mFirebaseUser = FirebaseAuth.getInstance().getCurrentUser();

        Log.v(TAG, &quot;checkUser ID == &quot; + app.mFirebaseUser.getUid());
        app.mFirebaseManager.mFirebaseDatabase.child(&quot;users&quot;)
                .child(app.mFirebaseUser.getUid()).addListenerForSingleValueEvent(
                new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot dataSnapshot) {
                        Log.v(TAG, &quot;mFirebaseListener.onSuccess &quot; + dataSnapshot);
                        if(dataSnapshot.exists()){
                            Log.v(TAG, &quot;User found : &quot; + app.mFirebaseUser.getEmail());
                        }
                        else{
                            Log.v(TAG, &quot;User not found, Creating User on Firebase&quot;);
                            User newUser = new User(app.mFirebaseUser.getUid(),
                                    app.mFirebaseUser.getDisplayName(),
                                    app.mFirebaseUser.getEmail(), null);
                            app.mFirebaseManager.mFirebaseDatabase.child(&quot;users&quot;)
                                    .child(app.mFirebaseUser.getUid())
                                    .setValue(newUser);
                        }
                        app.mFirebaseManager.mFirebaseUserId = app.mFirebaseUser.getUid();
                        startHomeScreen();
                    }

                    @Override
                    public void onCancelled(DatabaseError databaseError) {
                        Log.v(TAG, &quot;mFirebaseListener.onFailure &quot; + databaseError);
                        Log.v(TAG, &quot;Unable to Validate Existing Firebase User: &quot; + app.mFirebaseUser.getUid());
                        Toast.makeText(Login.this,&quot;Unable to Validate Existing Firebase User:&quot;,Toast.LENGTH_LONG).show();
                    }
                }
        );
    }</code></pre>
<p>and don&#39;t forget to add an instance of <strong>FirebaseManager</strong> to your application object.</p>
<p>Now see if you can make the necessary modifications to the project to</p>
<ul>
<li>open the database &#39;link&#39; to Firebase on App Startup</li>
<li>verify the currently signed-in user against the database or</li>
<li>add a new user if if&#39;s the first login attempt</li>
</ul>
<p>Before you can actually store data (our new users etc) you&#39;ll need to create your database. You could choose <strong>Firestore</strong></p>
<p><img src="img/db5.png" alt=""></p>
<p>but we&#39;ll be going with the <strong>Realtime Database</strong> for the moment</p>
<p><img src="img/db6.png" alt=""></p>
<p>Choose <strong>Locked Mode</strong> for your security rules</p>
<p><img src="img/db7.png" alt=""></p>
<p>and update them to the following</p>
<p><img src="img/db9.png" alt=""></p>
<p>If it all checks out you should see something like this</p>
<p>Initially, with no users</p>
<p> <img src="img/db8.png" alt=""></p>
<p> then with one new user (me :-) )</p>
<p> <img src="img/db10.png" alt=""></p>
<p>  etc. etc.</p>
<p> <img src="img/db11.png" alt=""></p>
<p> We can now verify a user against our database but more importantly, we can associate this user with a specific coffee when we add a coffee to our database - so that&#39;s next.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="05">
            <h1>Firebase CRUD - Add a Coffee</h1>
<p>At this point, we have to essentially &#39;break&#39; our app insofar as we need to change our <strong>Coffee</strong> model to allow us to store a users id with the coffee, when we add it to the firebase database.</p>
<p>First of all, introduce the following property into the <code>Coffee</code> model</p>
<pre><code class="lang-java">public String uid;</code></pre>
<p>and update your constructors accordingly.</p>
<p>Next, introduce the following method into your <strong>Coffee</strong> class for mapping our fields to JSON for storage</p>
<pre><code class="lang-java">@Exclude
    public Map&lt;String, Object&gt; toMap() {
        HashMap&lt;String, Object&gt; result = new HashMap&lt;&gt;();
        result.put(&quot;uid&quot;, uid);
        result.put(&quot;name&quot;, name);
        result.put(&quot;shop&quot;, shop);
        result.put(&quot;rating&quot;, rating);
        result.put(&quot;price&quot;, price);
        result.put(&quot;favourite&quot;, favourite);
        result.put(&quot;usertoken&quot;, usertoken);
        result.put(&quot;googlephoto&quot;, googlephoto);
        result.put(&quot;address&quot;, address);
        result.put(&quot;marker&quot;, marker);

        return result;
    }</code></pre>
<p>Finally, introduce the following methods into your <strong>FirebaseManager</strong> class</p>
<pre><code class="lang-java">public void addCoffee(final Coffee c)
    {
        mFirebaseDatabase.child(&quot;users&quot;).child(mFirebaseUserId).addListenerForSingleValueEvent(
                new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot dataSnapshot) {
                        // Get user value
                        User user = dataSnapshot.getValue(User.class);

                        if (user == null) {
                            // User is null, error out
                            Log.v(TAG, &quot;User &quot; + mFirebaseUserId + &quot; is unexpectedly null&quot;);

                        } else {
                            // Write new coffee here

                        }
                    }

                    @Override
                    public void onCancelled(DatabaseError databaseError) {
                        Log.v(TAG, &quot;getUser:onCancelled&quot;, databaseError.toException());
                    }
                });
    }

        private void writeNewCoffee(Coffee c) {
         // Create new coffee at /user-coffees/$userid/$coffeeid and at
         // /coffees/$coffeeid simultaneously
         String key = mFirebaseDatabase.child(&quot;coffees&quot;).push().getKey();
         Map&lt;String, Object&gt; coffeeValues = c.toMap();

         Map&lt;String, Object&gt; childUpdates = new HashMap&lt;&gt;();
         //All our coffees
         childUpdates.put(&quot;/coffees/&quot; + key, coffeeValues);
         //All coffees per user
         childUpdates.put(&quot;/user-coffees/&quot; + mFirebaseUserId + &quot;/&quot; + key, coffeeValues);

         mFirebaseDatabase.updateChildren(childUpdates).addOnSuccessListener(new OnSuccessListener&lt;Void&gt;() {
             @Override
             public void onSuccess(Void aVoid) {
                 // Write was successful!
                 Log.v(TAG, &quot;updateChildren Write Successful&quot;);
             }
         })
                 .addOnFailureListener(new OnFailureListener() {
                     @Override
                     public void onFailure(@NonNull Exception e) {
                         // Write failed
                         Log.v(TAG, &quot;updateChildren Write Failed with Error : &quot; + e.getLocalizedMessage());
                     }
                 });
     }</code></pre>
<p>and see can you now add a coffee to your firebase database.</p>
<p><img src="img/db13.png" alt=""></p>
<p>If you can, you should be seeing something like this</p>
<p><img src="img/db14.png" alt=""></p>
<p>and</p>
<p><img src="img/db15.png" alt=""></p>
<p>and</p>
<p><img src="img/db16.png" alt=""></p>
<p>Or maybe you&#39;re not? Did you update your <strong>Rules</strong> to account for the 2 new collections in your database like so?</p>
<p><img src="img/db12.png" alt=""></p>
<p>Experiment with different users to confirm your app is working correctly, like so</p>
<p><img src="img/db17.png" alt=""></p>
<p>and</p>
<p><img src="img/db18.png" alt=""></p>
<p>so the next step will be to retrieve these coffees from Firebase and display them on the device.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="06">
            <h1>Firebase CRUD - Get All Coffees / Favourite Coffees</h1>
<p>At the moment we can see our coffees being added on the Firebase console, but that&#39;s not much use to the user, so this step will involve retrieving all of the users coffees.</p>
<p>To leverage the realtime nature of our firebase database, we are going to make use of a <strong>FirebaseListAdapter</strong> which you can find out more about here <a href="https://github.com/firebase/FirebaseUI-Android/blob/master/README.md">https://github.com/firebase/FirebaseUI-Android/blob/master/README.md</a> and here <a href="https://firebaseopensource.com/projects/firebase/firebaseui-android/">https://firebaseopensource.com/projects/firebase/firebaseui-android/</a></p>
<p>We will need to replace our current version of our custom list adapter with a version that extends the above. To use the latest version of the FirebaseUI project (as of Dec 2018) we need to make a few changes to our project and module gradle files.</p>
<p>First, open your <strong>project</strong> build.gradle and make sure you have the following</p>
<pre><code class="lang-xml">allprojects {
    repositories {
        google()
        jcenter()
    }
}</code></pre>
<p>Now open your <strong>app</strong> build.gradle and add the following dependency</p>
<pre><code class="lang-xml">// FirebaseUI for Firebase Realtime Database
    implementation &#39;com.firebaseui:firebase-ui-database:4.0.0&#39;</code></pre>
<p>Sync your project again and you should be good to go.</p>
<p>Now, replace your existing <strong>CoffeeListAdapter</strong> with this one</p>
<pre><code class="lang-java">// https://github.com/firebase/FirebaseUI-Android/blob/master/README.md

// https://github.com/firebase/FirebaseUI-Android/blob/master/database/README.md

// https://groups.google.com/forum/#!topic/firebase-talk/O1kJ4VLUg10

public class CoffeeListAdapter extends FirebaseListAdapter&lt;Coffee&gt; {

    private View.OnClickListener deleteListener;
    FirebaseListOptions&lt;Coffee&gt; options;

    public CoffeeListAdapter(View.OnClickListener deleteListener,
                             FirebaseListOptions&lt;Coffee&gt; options) {
        super(options);
        Log.v(&quot;coffeemate&quot;,&quot;Creating Adapter with :&quot; + options.toString());
        this.deleteListener = deleteListener;
        this.options = options;
    }

    @Override
    protected void populateView(View row, Coffee coffee, int position) {
        Log.v(&quot;coffeemate&quot;,&quot;Populating View Adapter with :&quot; + coffee);
        //Set the rows TAG to the coffee &#39;key&#39;
        row.setTag(getRef(position).getKey());

        ((TextView) row.findViewById(R.id.rowCoffeeName)).setText(coffee.name);
        ((TextView) row.findViewById(R.id.rowCoffeeShop)).setText(coffee.shop);
        ((TextView) row.findViewById(R.id.rowRating)).setText(coffee.rating + &quot; *&quot;);
        ((TextView) row.findViewById(R.id.rowPrice)).setText(&quot;â‚¬&quot; +
                new DecimalFormat(&quot;0.00&quot;).format(coffee.price));

        ImageView imgIcon = row.findViewById(R.id.rowFavouriteImg);

        if (coffee.favourite)
            imgIcon.setImageResource(R.drawable.favourites_72_on);
        else
            imgIcon.setImageResource(R.drawable.favourites_72);

        ImageView imgDelete = row.findViewById(R.id.rowDeleteImg);
        imgDelete.setTag(getRef(position).getKey());
        imgDelete.setOnClickListener(deleteListener);
    }</code></pre>
<p>Open your <strong>FirebaseManager</strong> class and introduce the following methods</p>
<pre><code class="lang-java">public Query getAllCoffees() {
        return mFirebaseDatabase
                .child(&quot;user-coffees&quot;)
                .child(mFirebaseUserId)
                .orderByChild(&quot;rating&quot;);
    }

public Query getFavouriteCoffees() {
           return mFirebaseDatabase
                   .child(&quot;user-coffees&quot;)
                   .child(mFirebaseUserId)
                   .orderByChild(&quot;favourite&quot;)
                   .equalTo(true);
       }</code></pre>
<p>and finally, open your <strong>CoffeeFragment</strong> class and bring in/update the following properties/methods/code extracts</p>
<pre><code class="lang-java">public FirebaseListOptions options;
public Query query;
public CoffeeMateApp app = CoffeeMateApp.getInstance();</code></pre>
<pre><code class="lang-java">@Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }

public void onResume() {
       super.onResume();
       if (!favourites)
           query = app.mFirebaseManager.getAllCoffees();
       else
           query = app.mFirebaseManager.getFavouriteCoffees();

       updateView(query);
   }</code></pre>
<pre><code class="lang-java">   @Override
   public void onStop() {
       super.onStop();
       listAdapter.stopListening();
   }</code></pre>
<pre><code class="lang-java">public void updateView(Query query) {

  options = new FirebaseListOptions.Builder&lt;Coffee&gt;()
          .setQuery(query, Coffee.class)
          .setLayout(R.layout.coffeerow)
          .build();

  listAdapter = new CoffeeListAdapter(this, options);
  listAdapter.startListening();

       setListView(v);
       setSwipeRefresh(v);

       if(!favourites)
           getActivity().setTitle(R.string.recentlyViewedLbl);
       else
           getActivity().setTitle(R.string.favouritesCoffeeLbl);
   }</code></pre>
<p>and remove <strong><em>ALL</em></strong> <strong>VolleyListener</strong> references and implemented methods.</p>
<p>(We&#39;ll sort out deleting and filtering later on)</p>
<p>Now, run your app again and once you sign in, you should be seeing the coffees associated with the user stored in the Firebase database and your favourites should be working too.</p>
<p><img src="img/db19.png" alt=""></p>
<p>Now if you visit your Firebase console and manually edit some coffee data (change the rating value or the name in the example below) and keep an eye on your list on your device (all going well!) you&#39;ll see the data automatically change, without any swipe and or refreshing of the list, demonstrating the FirebaseUI realtime updates, like so</p>
<p><img src="img/db20.png" alt=""></p>
<p>and then</p>
<p><img src="img/db21.png" alt=""></p>
<p>pretty cool I think :)</p>
<p>On to the next step.....</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="07">
            <h1>Firebase CRUD - Updating a Coffee</h1>
<p>Up to now, to see any changes/updates to our list of coffees we had to manually make those changes on the console. This step will involve allowing a coffee to be updated on the app and subsequently we&#39;ll be able to see those changes happen in realtime on our Firebase console.</p>
<p>Similar to previous versions, we have to first retrieve the particular coffee from Firebase, make the changes and then refresh the data remotely.</p>
<p>We also need to reintroduce a Callback Listener if we want to maintain the current architecture (a Manager class for the calls) so first, add the following interface</p>
<pre><code class="lang-java">public interface FirebaseListener {
    void onSuccess(DataSnapshot dataSnapshot);
    void onFailure();
}</code></pre>
<p>and the following inside your <strong>FirebaseManager</strong></p>
<pre><code class="lang-java">public FirebaseListener mFirebaseListener;</code></pre>
<p>and</p>
<pre><code class="lang-java">public void attachListener(FirebaseListener listener) {
    mFirebaseListener = listener;
}</code></pre>
<p>Next, add these methods to the same class</p>
<pre><code class="lang-java">public void getACoffee(final String coffeeKey)
    {
        mFirebaseDatabase.child(&quot;user-coffees&quot;).child(mFirebaseUserId).child(coffeeKey).addValueEventListener(
                new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot dataSnapshot) {
                        Log.v(TAG,&quot;The read Succeeded: &quot; + dataSnapshot.toString());
                        mFirebaseListener.onSuccess(dataSnapshot);
                    }
                    @Override
                    public void onCancelled(DatabaseError firebaseError) {
                        Log.v(TAG,&quot;The read failed: &quot; + firebaseError.getMessage());
                        mFirebaseListener.onFailure();
                    }
                });
    }

    public void updateACoffee(final String coffeeKey,final Coffee updatedCoffee)
    {
        mFirebaseDatabase.child(&quot;user-coffees&quot;).child(mFirebaseUserId).child(coffeeKey).addListenerForSingleValueEvent(
                new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot dataSnapshot) {
                        Log.v(TAG,&quot;The update Succeeded: &quot; + dataSnapshot.toString());
                        dataSnapshot.getRef().setValue(updatedCoffee);
                    }
                    @Override
                    public void onCancelled(DatabaseError firebaseError) {
                        Log.v(TAG,&quot;The update failed: &quot; + firebaseError.getMessage());
                        mFirebaseListener.onFailure();
                    }
                });
    }</code></pre>
<p>Once you&#39;ve fixed any errors, open <strong>EditFragment</strong> and replace <em>VolleyListener</em> with <em>FirebaseListener</em>, and again fix the resultant errors.</p>
<p>Next, to begin with, for completeness (and identifying a few changes we need to make) rename the &#39;coffeeID&#39; property to &#39;coffeeKey&#39; - don&#39;t forget to make the relevant change in <strong>CoffeeFragment</strong>.</p>
<p>Then &#39;attach&#39; the Listener to the fragment and see can you correctly call the <strong>getACoffee()</strong> method and implement the Listener methods.</p>
<p>You&#39;ll need this in the Listener method successful call</p>
<pre><code class="lang-java">aCoffee = dataSnapshot.getValue(Coffee.class);</code></pre>
<p>Don&#39;t forget to update how you access your <strong><em>app</em></strong> instance and remember to call <strong>updateUI()</strong> to display the coffee data on screen.</p>
<p>The last thing to do is actually update the data on the server once the user clicks &#39;update&#39; so using this method call</p>
<pre><code class="lang-java"> app.mFirebaseManager.updateACoffee(/*the coffeekey*/,aCoffee);</code></pre>
<p>have a go at that.</p>
<p>We&#39;ll also add the option for the user to toggle on/off the favourites star independently from having to update the coffee details so just to be complete, open up your <strong>FirebaseManager</strong> class and add the following</p>
<pre><code class="lang-java">public void toggleFavourite(final String coffeeKey,final boolean isFavourite)
    {
        mFirebaseDatabase.child(&quot;user-coffees&quot;).child(mFirebaseUserId).child(coffeeKey).addListenerForSingleValueEvent(
                new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot snapshot) {
                        snapshot.getRef().child(&quot;favourite&quot;).setValue(isFavourite);
                    }
                    @Override
                    public void onCancelled(DatabaseError firebaseError) {
                        Log.v(TAG,&quot;The toggle failed: &quot; + firebaseError.getMessage());
                    }
                });
    }</code></pre>
<p>and have a go at that too.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="08">
            <h1>Firebase CRUD - Deleting Coffees</h1>
<p>This step involves two features</p>
<ul>
<li>deleting a single coffee and</li>
<li>deleting multiple coffees</li>
</ul>
<p>so we&#39;ll start with the slightly more difficult option - deleting a single coffee.</p>
<p>First, open your <strong>FirebaseManager</strong> class and add the following</p>
<pre><code class="lang-java">public void deleteACoffee(final String coffeeKey)
    {
        mFirebaseDatabase.child(&quot;user-coffees&quot;).child(mFirebaseUserId)
        .child(coffeeKey).addListenerForSingleValueEvent(
                new ValueEventListener() {
                    @Override
                    public void onDataChange(DataSnapshot snapshot) {
                        snapshot.getRef().removeValue();
                    }
                    @Override
                    public void onCancelled(DatabaseError firebaseError) {
                        Log.v(TAG,&quot;The delete failed: &quot; + firebaseError.getMessage());
                    }
                });
    }</code></pre>
<p>Now, try and work out where <strong><em>deleteACoffee()</em></strong> should be called and the minor changes that need to be made to the existing <strong><em>onCoffeeDelete()</em></strong>.</p>
<p>To finish this step, deleting multiple coffees is literally one line of code, so try and work that out too (at least without looking at the notes first :) )</p>
<p>and you may find the following method useful?</p>
<pre><code class="lang-java">listView.getChildAt()</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="09">
            <h1>Firebase CRUD - Searching &amp; Filtering Coffees</h1>
<p>At the time of writing (December/2018) there is still no way to search Firebase like you would a normal relational Database using SQL LIKE etc. For reference though and if you fancy seeing if you can integrate any of the following, I found some useful links worth a looking</p>
<p><strong><a href="https://github.com/xdrop/fuzzywuzzy">https://github.com/xdrop/fuzzywuzzy</a></strong></p>
<p><strong><a href="https://support.google.com/firebase/answer/6318765?hl=en">https://support.google.com/firebase/answer/6318765?hl=en</a></strong></p>
<p><strong><a href="https://cloud.google.com/bigquery/docs/reference/libraries">https://cloud.google.com/bigquery/docs/reference/libraries</a></strong></p>
<p><strong><a href="https://groups.google.com/forum/#!topic/firebase-talk/kHFSfp7zNDk">https://groups.google.com/forum/#!topic/firebase-talk/kHFSfp7zNDk</a></strong> (and subsequent links within)</p>
<p>I&#39;ll revisit this once I have time (or if Firebase adds this functionality :) )</p>
<p>As a result, we&#39;re a bit limited in what we can do in terms of searching our list, but we will implement some basic searching &amp; filtering on our &#39;Search&#39; screen to try and replicate what we had in the previous versions of <strong>CoffeeMate</strong>.</p>
<p>So, first, open your <strong>FirebaseManager</strong> and add the following</p>
<pre><code class="lang-java">public Query nameFilter(String s)
  {
      Query query = mFirebaseDatabase.child(&quot;user-coffees&quot;).child(mFirebaseUserId)
              .orderByChild(&quot;name&quot;).startAt(s).endAt(s+&quot;\uf8ff&quot;);

      return query;
  }</code></pre>
<p>Next, open your <strong>CoffeeFilter</strong> and replace it with the following (and fix any import errors)</p>
<pre><code class="lang-java">public class CoffeeFilter extends Filter {
    private String                 filterText;
    private CoffeeListAdapter     adapter;
    private Query                query;
    private CoffeeFragment        fragment;

    public CoffeeFilter(Query originalCoffeeQuery, String filterText
            ,CoffeeListAdapter adapter,CoffeeFragment fragment) {
        super();
        this.query = originalCoffeeQuery;
        this.filterText = filterText;
        this.adapter = adapter;
        this.fragment = fragment;
    }

    public void setFilter(String filterText) {
        this.filterText = filterText;
    }

    @Override
    protected FilterResults performFiltering(CharSequence prefix) {
        FilterResults results = new FilterResults();

        if(prefix != null)
            if (prefix.length() &gt; 0)
                query = fragment.app.mFirebaseBManager.nameFilter(prefix.toString());

        else {
            if (filterText.equals(&quot;all&quot;)) {
                query = fragment.app.mFirebaseBManager.getAllCoffees();
            } else if (filterText.equals(&quot;favourites&quot;)) {
                query = fragment.app.mFirebaseBManager.getFavouriteCoffees();
            }
        }
        results.values = query;

        return results;
    }

    @Override
    protected void publishResults(CharSequence prefix, FilterResults results) {

        fragment.updateView((Query) results.values);
    }
}</code></pre>
<p>Now this will trigger a number of errors so open your <strong>CoffeeFragment</strong> and <strong>SearchFragment</strong> classes and update your <strong><em>coffeeFilter</em></strong> (in the relevant places) so that it takes a <strong><em>query</em></strong> as the first parameter, instead of the existing list. And do the same for the <em>updateView()</em> method.</p>
<p>Some refactoring of both classes is necessary at this stage so go ahead and carry out the following</p>
<ul>
<li>move the instantiation of your <em>coffeeFilter</em> from <strong>CoffeeFragment</strong> to <strong>SearchFragment</strong>&#39;s <em>onCreateView()</em></li>
<li><p>remove the following from <strong>CoffeeFragment</strong>&#39;s <em>onResume()</em></p>
<pre><code class="lang-java">    coffeeFilter.setFilter(&quot;favourites&quot;); // Set the filter text field from &#39;all&#39; to &#39;favourites&#39;
    coffeeFilter.filter(null); // Filter the data, but don&#39;t use any prefix</code></pre>
</li>
<li><p>update your <strong><em>updateView()</em></strong> to the following</p>
<pre><code class="lang-java">public void updateView(Query query) {

     options = new FirebaseListOptions.Builder&lt;Coffee&gt;()
             .setQuery(query, Coffee.class)
             .setLayout(R.layout.coffeerow)
             .build();

     listAdapter = new CoffeeListAdapter(this, options);
     listAdapter.startListening();
     setListView(v);

     if(favourites)
         getActivity().setTitle(R.string.favouritesCoffeeLbl);
     else
         if(this instanceof SearchFragment)
             getActivity().setTitle(R.string.searchCoffeesLbl);
         else
             getActivity().setTitle(R.string.recentlyViewedLbl);
 }</code></pre>
</li>
</ul>
<p>Run your app once again, and you should be able to see something like the following (I&#39;ve added some dummy data to illustrate)</p>
<p>Our initial &#39;Search&#39; screen</p>
<p><img src="img/db22.png" alt=""></p>
<p>Filtering on &#39;Favourites&#39;</p>
<p><img src="img/db23.png" alt=""></p>
<p>Filtering on String name &#39;G&#39;</p>
<p><img src="img/db24.png" alt=""></p>
<p>Filtering on String name &#39;Gr&#39;</p>
<p><img src="img/db25.png" alt=""></p>
<p>If you wish, you can do some housekeeping on the entire project at this stage and remove the <strong>mSwipeRefreshLayout</strong> references, as we don&#39;t actually need it anymore due to the <strong>FirebaseUI</strong> api and the realtime nature of our database. Also, to get you started on the refactoring for the last step, delete the <strong>VolleyListener</strong> interface altogether, as again, we don&#39;t need this anymore either and all the REST method can be removed from our <strong>CoffeeApi</strong> class (we&#39;ll delete this class too in the final step). It will throw up a number of errors so try and fix as many as you can before moving on to the next step. You can of course, just leave everything as it is :)</p>
<p>The last thing we need to do is make sure our Map is showing the correct marker locations, as currently we&#39;re still retrieving from the FullFat Heroku server and not Firebase, so that&#39;s next.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="10">
            <h1>Firebase CRUD - Managing our Coffee Map</h1>
<p>Currently our <strong>MapsFragment</strong> is implementing the <em>VolleyListener</em> interface (or you&#39;ve removed it entirely) and requesting the list of coffees from the FullFat Heroku server, so this step requires a refactoring of the interface to use, and the call we need to make to get our coffees from Firebase.</p>
<p>First make a call to <strong>getAllCoffees()</strong> where you had previously made a call to get the coffees from the Heroku server. Then add a <strong>addValueEventListener</strong> call
and you will probably need this code to convert your resultant firebase <em>snapshot</em> into a list of coffees, to add to the Map</p>
<pre><code class="lang-java">List &lt;Coffee&gt; coffeeList = new ArrayList&lt;Coffee&gt;();

        for (DataSnapshot coffeeSnapshot: dataSnapshot.getChildren()) {
            Coffee c = coffeeSnapshot.getValue(Coffee.class);
            coffeeList.add(c);
        }</code></pre>
<p>Add the coffees to the map via your existing <strong>addCoffees</strong> method and run your app to see what happens.</p>
<p>Hopefully, you&#39;ll then see something like this</p>
<p>Our Firebase coffees</p>
<p><img src="img/db26.png" alt=""></p>
<p>And the same coffees on the Map</p>
<p><img src="img/db27.png" alt=""></p>
<p>and</p>
<p><img src="img/db28.png" alt=""></p>
<p>If you go to Add a Coffee, you won&#39;t need to clear and add the coffees to the map again in the fragment, as we&#39;ve had to do previously as Firebase looks after that too. As a result, you can remove the callback and the <strong>onMapReady()</strong> method.</p>
<p>Now, for a final bit of housekeeping, we&#39;ll use <a href="https://github.com/bumptech/glide">Glide</a> to load our Google Profile photo instead of making a Volley request, so using</p>
<pre><code class="lang-java">Glide.with(/*context*/).load(/*url*/).into(/*ImageView*/);</code></pre>
<p>see can you get rid of the <strong>CoffeeApi</strong> class altogether and use Glide to load the users Google Profile photo.</p>
<p>The final project structure, after housekeeping, looks something like this</p>
<p><img src="img/db29.png" alt=""></p>
<p>All Done!!!</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Solution">
            <h1>Solution</h1>
<p>This is a solution to the lab:</p>
<ul>
<li><a href="archives/CoffeeMate.9.0.Solution.zip">CoffeeMate.9.0.Solution</a></li>
</ul>

          </div>
        
      </div>
    </div>
  </div>



  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> 
      </div>
    </div>
  </div>

  </body>

</html>