<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css"
          type="text/css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css"
          rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html"> UI Design & App Structure  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Lab-03">
          Lab-03
        </a>
      
        <a class="item" data-tab="01">
          01
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="03">
          03
        </a>
      
        <a class="item" data-tab="04">
          04
        </a>
      
        <a class="item" data-tab="05">
          05
        </a>
      
        <a class="item" data-tab="06">
          06
        </a>
      
        <a class="item" data-tab="07">
          07
        </a>
      
        <a class="item" data-tab="Solution">
          Solution
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic01-overview-and-tools/unit-1/book-ahelloworld-lab-01/index.html">HelloWorld </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic01-overview-and-tools/unit-1/book-coffeemate-lab-01/index.html">Lab-01 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic02-ui-design/unit-1/book-coffeemate-lab-02/index.html">Lab-02 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic02-ui-design/unit-1/book-coffeemate-lab-03/index.html">Lab-03 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic02-ui-design/unit-2/book-coffeemate-lab-04/index.html">Lab-04 </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic03-persistence/unit-1/book-coffeemate-lab-05-a/index.html">Lab-05-a </a>
          
        
      
        
          
            <a class="item"
               href="http://ddrohan.github.io/wit-mad-msc-2019//topic03-persistence/unit-1/book-coffeemate-lab-05-b/index.html">Lab-05-b </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Lab-03">
            <h1>Objectives</h1>
<p>In this Lab, <b>CoffeeMate.3.0</b> we will again build on the previous lab and add in more new features and UI Design. On completion of this lab you&#39;ll be able to use multiple Fragments in different Activities, use Spinners (dropdown lists), filter lists and use the <b>Application</b> Object</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="01">
            <h1>Setup - Starter Code</h1>
<p>To complete this lab you can either continue on with your solution from Lab 02 (CoffeeMate.2.0) or download the previous solution here <a href="archives/CoffeeMate.3.0.Starter.zip">CoffeeMate.3.0.Starter</a></p>
<p>To open this in Android Studio, first extract the archive somewhere on your hard drive and select &#39;File-&gt;Open&#39; etc.</p>
<p>Once you open/import the <b>CoffeeMate.3.0</b> Project you&#39;ll probably need to &#39;Clean &amp; Build&#39; the project to fix any residual errors.</p>
<p>Next, go ahead and create 2 new Empty Activities
- <b>Favourites</b> and
- <b>Search</b></p>
<p>and name the layouts appropriately (as we&#39;ve done previously). Don&#39;t forget to set their Base class as &#39;<b>Base</b>&#39;.</p>
<p>Next, replace your &#39;favourites&#39; layout with this (you&#39;ll need to add a new &#39;red&#39; color resource yourself)</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    tools:context=&quot;.activities.Favourites&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/favouriteBarTV&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;21dp&quot;
        android:layout_marginEnd=&quot;8dp&quot;
        android:layout_marginStart=&quot;8dp&quot;
        android:layout_marginTop=&quot;108dp&quot;
        android:background=&quot;@color/colorPrimary&quot;
        android:text=&quot;@string/recentlyViewedLbl&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorFontWhite&quot;
        android:textSize=&quot;16sp&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/footer&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;36dp&quot;
        android:background=&quot;@color/colorPrimary&quot;
        android:paddingTop=&quot;5dp&quot;
        android:text=&quot;@string/appWebsite&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorFontWhite&quot;
        android:textSize=&quot;16sp&quot;
        android:textStyle=&quot;bold&quot;
        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintHorizontal_bias=&quot;0.0&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;

    &lt;FrameLayout
        android:id=&quot;@+id/fragment_container&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;0dp&quot;
        android:layout_marginTop=&quot;8dp&quot;
        app:layout_constraintBottom_toTopOf=&quot;@+id/footer&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintHorizontal_bias=&quot;0.5&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toBottomOf=&quot;@+id/favouriteBarTV&quot;&gt;

        &lt;TextView
            android:id=&quot;@+id/emptyList&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;top|center_horizontal&quot;
            android:layout_marginTop=&quot;30dp&quot;
            android:text=&quot;@string/emptyMessageLbl&quot;
            android:textSize=&quot;12sp&quot;
            app:layout_constraintHorizontal_bias=&quot;0.576&quot;
            app:layout_constraintVertical_bias=&quot;0.533&quot; /&gt;
    &lt;/FrameLayout&gt;

    &lt;TextView
        android:id=&quot;@+id/favouriteCoffeeName&quot;
        android:layout_width=&quot;174dp&quot;
        android:layout_height=&quot;40dp&quot;
        android:layout_marginStart=&quot;8dp&quot;
        android:layout_marginTop=&quot;8dp&quot;
        android:text=&quot;CoffeeName&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorFontBlack&quot;
        android:textSize=&quot;30sp&quot;
        android:textStyle=&quot;bold&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/favouriteCoffeeShop&quot;
        android:layout_width=&quot;94dp&quot;
        android:layout_height=&quot;25dp&quot;
        android:layout_marginStart=&quot;48dp&quot;
        android:layout_marginTop=&quot;20dp&quot;
        android:text=&quot;shop&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorPrimaryDark&quot;
        android:textSize=&quot;18sp&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toBottomOf=&quot;@+id/favouriteCoffeeName&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/favouriteCoffeePrice&quot;
        android:layout_width=&quot;94dp&quot;
        android:layout_height=&quot;25dp&quot;
        android:layout_marginEnd=&quot;52dp&quot;
        android:layout_marginTop=&quot;20dp&quot;
        android:text=&quot;price&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorPrimaryDark&quot;
        android:textSize=&quot;18sp&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintTop_toBottomOf=&quot;@+id/favouriteCoffeeRating&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/favouriteCoffeeRating&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginEnd=&quot;56dp&quot;
        android:layout_marginTop=&quot;8dp&quot;
        android:text=&quot;Rating&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorFontRed&quot;
        android:textSize=&quot;30sp&quot;
        android:textStyle=&quot;bold&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;


&lt;/android.support.constraint.ConstraintLayout&gt;</code></pre>
<p>and your &#39;search&#39; layout with this</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;android.support.constraint.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    tools:context=&quot;.activities.Search&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/searchBarTV&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;21dp&quot;
        android:background=&quot;@color/colorPrimary&quot;
        android:text=&quot;@string/searchCoffeesLbl&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorFontWhite&quot;
        android:textSize=&quot;16sp&quot;
        app:layout_constraintBottom_toTopOf=&quot;@+id/footer&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintHorizontal_bias=&quot;0.0&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toBottomOf=&quot;@+id/searchSpinner&quot;
        app:layout_constraintVertical_bias=&quot;0.0&quot; /&gt;

    &lt;TextView
        android:id=&quot;@+id/footer&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;36dp&quot;
        android:background=&quot;@color/colorPrimary&quot;
        android:paddingTop=&quot;5dp&quot;
        android:text=&quot;@string/appWebsite&quot;
        android:textAlignment=&quot;center&quot;
        android:textColor=&quot;@color/colorFontWhite&quot;
        android:textSize=&quot;16sp&quot;
        android:textStyle=&quot;bold&quot;
        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintHorizontal_bias=&quot;0.0&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot; /&gt;

    &lt;FrameLayout
        android:id=&quot;@+id/fragment_container&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;0dp&quot;
        android:layout_marginTop=&quot;8dp&quot;
        app:layout_constraintBottom_toTopOf=&quot;@+id/footer&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintHorizontal_bias=&quot;0.5&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toBottomOf=&quot;@+id/searchBarTV&quot;&gt;

        &lt;TextView
            android:id=&quot;@+id/emptyList&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;top|center_horizontal&quot;
            android:layout_marginTop=&quot;30dp&quot;
            android:text=&quot;@string/emptyMessageLbl&quot;
            android:textSize=&quot;12sp&quot;
            app:layout_constraintHorizontal_bias=&quot;0.576&quot;
            app:layout_constraintVertical_bias=&quot;0.533&quot; /&gt;
    &lt;/FrameLayout&gt;

    &lt;Spinner
        android:id=&quot;@+id/searchSpinner&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;50dp&quot;
        android:layout_marginBottom=&quot;8dp&quot;
        android:layout_marginEnd=&quot;8dp&quot;
        android:layout_marginStart=&quot;8dp&quot;
        android:layout_marginTop=&quot;8dp&quot;
        app:layout_constraintBottom_toTopOf=&quot;@+id/footer&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot;
        app:layout_constraintVertical_bias=&quot;0.112&quot; /&gt;

    &lt;SearchView
        android:id=&quot;@+id/searchView&quot;
        android:layout_width=&quot;0dp&quot;
        android:layout_height=&quot;46dp&quot;
        android:layout_marginBottom=&quot;8dp&quot;
        android:layout_marginEnd=&quot;8dp&quot;
        android:layout_marginStart=&quot;8dp&quot;
        android:layout_marginTop=&quot;8dp&quot;
        android:visibility=&quot;visible&quot;
        android:background=&quot;#fff&quot;
        android:elevation=&quot;2dp&quot;
        app:layout_constraintBottom_toBottomOf=&quot;@+id/searchSpinner&quot;
        app:layout_constraintEnd_toEndOf=&quot;parent&quot;
        app:layout_constraintStart_toStartOf=&quot;parent&quot;
        app:layout_constraintTop_toTopOf=&quot;parent&quot;
        app:layout_constraintVertical_bias=&quot;0.14&quot; /&gt;

&lt;/android.support.constraint.ConstraintLayout&gt;</code></pre>
<p>Run your app to confirm you can now load the &#39;search&#39; and &#39;favourites&#39; screens. If you can&#39;t, try and work out why. To point you in the right direction you may need to wire up the buttons on the layout to the relevant method in your <b>Home.java</b> which can be done like so</p>
<p><img src="img/onclick.png" alt=""></p>
<p>Notice how the method is already listed as it&#39;s being picked up from the associated Activity.</p>
<p>Run the app again to confirm.</p>
<p>Next, create a new java class called <b>CoffeeFilter</b> in the &#39;adapters&#39; package and replace it with the following</p>
<pre><code class="lang-java">public class CoffeeFilter extends Filter {
    public List&lt;Coffee&gt; originalCoffeeList;
    public String filterText;
    public CoffeeListAdapter adapter;

    public CoffeeFilter(List&lt;Coffee&gt; originalCoffeeList, String filterText,
                        CoffeeListAdapter adapter) {
        super();
        this.originalCoffeeList = originalCoffeeList;
        this.filterText = filterText;
        this.adapter = adapter;
    }

    public void setFilter(String filterText) {
        this.filterText = filterText;
    }

    @Override
    protected FilterResults performFiltering(CharSequence prefix) {
        FilterResults results = new FilterResults();

        List&lt;Coffee&gt; newCoffees;
        String coffeeName;

        if (prefix == null || prefix.length() == 0) {
            newCoffees = new ArrayList&lt;&gt;();
            if (filterText.equals(&quot;all&quot;)) {
                results.values = originalCoffeeList;
                results.count = originalCoffeeList.size();
            } else {
                if (filterText.equals(&quot;favourites&quot;)) {
                    for (Coffee c : originalCoffeeList)
                        if (c.favourite)
                            newCoffees.add(c);
                }
                results.values = newCoffees;
                results.count = newCoffees.size();
            }
        } else {
            String prefixString = prefix.toString().toLowerCase();
            newCoffees = new ArrayList&lt;&gt;();

            for (Coffee c : originalCoffeeList) {
                coffeeName = c.coffeeName.toLowerCase();
                if (coffeeName.contains(prefixString)) {
                    if (filterText.equals(&quot;all&quot;)) {
                        newCoffees.add(c);
                    } else if (c.favourite) {
                        newCoffees.add(c);
                    }}}
            results.values = newCoffees;
            results.count = newCoffees.size();
        }
        return results;
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    @Override
    protected void publishResults(CharSequence prefix, FilterResults results) {

        adapter.coffeeList = (ArrayList&lt;Coffee&gt;) results.values;

        if (results.count &gt;= 0)
            adapter.notifyDataSetChanged();
        else {
            adapter.notifyDataSetInvalidated();
            adapter.coffeeList = originalCoffeeList;
        }
    }
}</code></pre>
<p>and finally, create a new &#39;Blank&#39; Fragment called <b>SearchFragment</b> in the &#39;fragments&#39; package with the following settings :</p>
<p><img src="img/blankfragment.png" alt=""></p>
<p>Once the initial setup is complete your <b>CoffeeMate 3.0</b> Project in Android Studio should looks as follows:</p>
<p><img src="img/starter.3.png" alt=""></p>
<p>Take a few moments to familiarise yourself with the <b>new</b> classes in your project and explore the resources and layouts that you will be referring to throughout the lab, especially the new layouts in both &#39;Design&#39; view and &#39;Text&#39; view. It&#39;s also probably a good idea to run the App at this stage too, so you can set up your AVD (if you haven&#39;t done so already) and confirm that the starter app is configured properly and running (although &#39;Search&#39; and &#39;Favourites&#39; don&#39;t really do anything).</p>
<p>In this lab, you are required to do the following:</p>
<ul>
<li><p>Display a list of the users &#39;Favourite&#39; Coffees, highlighting the best &#39;rated&#39; coffee</p>
</li>
<li><p>Allow Coffees in the list to be filtered on their type and name and rating.</p>
</li>
</ul>
<p>The following steps will guide you through these requirements, so we&#39;ll start with refactoring the necessary classes.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>CoffeeMate 3.0 - A First Look</h1>
<p>When we&#39;re finished this lab, we&#39;ll be able to display the users Favourite coffees and apply a filter to the list of coffees so the user can search on a coffee name or type, or both. If you&#39;ve followed step 1 correctly you&#39;ll see that the &#39;Search&#39; &amp; &#39;Favourites&#39; buttons are working, but not functioning properly - we&#39;re not seeing any refined list of coffees.</p>
<p> <img src="img/searchstarter.png" alt=""> <img src="img/favouritesstarter.png" alt=""></p>
<p>Furthermore, there&#39;s nothing to select from the Spinner (second screenshot above) so the rest of this lab is all about refactoring existing classes to get these features working.</p>
<p>It&#39;s also worth confirming your <b>Home.java</b> looks something like below.</p>
<p>The following steps will take you through completing <b><i>CoffeeMate 3.0</i></b>.</p>
<pre><code class="lang-java">public class Home extends Base {

    TextView emptyList;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.home);
        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);

        emptyList = findViewById(R.id.emptyList);

        FloatingActionButton fab = findViewById(R.id.fab);
        fab.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Snackbar.make(view, &quot;Information&quot;, Snackbar.LENGTH_LONG)
                        .setAction(&quot;More Info...&quot;, new View.OnClickListener() {
                            @Override
                            public void onClick(View view) {

                            }
                        }).show();
            }
        });
        if(coffeeList.isEmpty()) setupCoffees();
    }

    public void add(View v) {
        startActivity(new Intent(this, Add.class));
    }

    public void search(View v) {
        startActivity(new Intent(this, Search.class));
    }

    public void favourites(View v) { startActivity(new Intent(this, Favourites.class));
    }

    @Override
    protected void onResume() {
        super.onResume();

        if(coffeeList.isEmpty())
            emptyList.setText(getString(R.string.emptyMessageLbl));
        else
            emptyList.setText(&quot;&quot;);

        coffeeFragment = CoffeeFragment.newInstance(); //get a new Fragment instance
        getFragmentManager().beginTransaction()
                .replace(R.id.fragment_container, coffeeFragment)
                .commit(); // add it to the current activity
    }

    public void setupCoffees(){
        coffeeList.add(new Coffee(&quot;Standard Black&quot;, &quot;Some Shop&quot;,2.5,1.99,false));
        coffeeList.add(new Coffee(&quot;Regular Joe&quot;, &quot;Joe&#39;s Place&quot;,3.5,2.99,true));
        coffeeList.add(new Coffee(&quot;Espresso&quot;, &quot;Ardkeen Stores&quot;,4.5,1.49,true));
    }
}</code></pre>

          </div>
        
          <div class="ui tab segment lab" data-tab="03">
            <h1>Reusing Fragments - &#39;Search&#39; &amp; Favourites&#39;</h1>
<p>If you recall in <b><i>CoffeeMate 2.0</i></b> we used a <b><i>Fragment</i></b> to display our list of coffees inside our Home Screen. A Fragments main purpose is to be <u><i>reused</i></u>, so we can use our existing Fragment in both our Search &amp; Favourites Screens.</p>
<h1>Search &amp; Favourites Screens</h1>
<p>The first thing we&#39;ll do is add the Fragment to our <b>Search.java</b> and <b>Favourites.java</b> Activity classes. This is pretty straightforward as we have already done this in our <b>Home.java</b> in <b><i>CoffeeMate 2.0</i></b>.</p>
<pre><code class="lang-java">  coffeeFragment = CoffeeFragment.newInstance(); //get a new Fragment instance
            getFragmentManager()
                    .beginTransaction()
                    .replace(R.id.fragment_container, coffeeFragment)
                    .commit(); // add/replace in the current activity</code></pre>
<p>You can literally cut &amp; paste the above code into both activity classes <b>onResume()</b> method and run the app, so see what you get?</p>
<p>And don&#39;t forget you can use Android Studio&#39;s tools for overriding methods (Here&#39;s another way to do it)</p>
<p><img src="img/lab0405a.png" alt=""></p>
<p>and then</p>
<p><img src="img/lab0405b.png" alt=""></p>
<p>You should be seeing something like the following :</p>
<p><img src="img/searchlist.png" alt=""> <img src="img/favouriteslist.png" alt=""></p>
<p>If you&#39;re seeing the &quot;empty coffees&quot; message behind the list, have a look at your Home.java and see if you can fix that?</p>
<p>Obviously, our Favourites isn&#39;t filtered to show just &#39;Favourite Coffees&#39; (we&#39;ll get to that later), but this does really illustrate the benefits of using Fragments when we can. See if you can edit and/or delete coffees?</p>
<p>The next step is introducing the Filter so the user can view their Favourite Coffees (and eventually search).</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="04">
            <h1>Reusing Fragments - Filtering Favourite Coffees</h1>
<p>As mentioned in the Lectures, a <i>ListView</i> supports filtering of elements via its adapter. In this step we will associate our custom filter (<b>CoffeeFilter.java</b>) with our <i>CoffeeFragment</i> so that we have the ability to filter this list whatever way we want, on any screen we want.</p>
<h1>Our Custom Filter - <b>CoffeeFilter.java</b></h1>
<p>First of all, familiarise yourself with the (already supplied) <i>CoffeeFilter</i> class. Pay particular attention to the two methods that had to be implemented to actually filter the data and then &#39;publish&#39; the results and make sure you understand what&#39;s going on.</p>
<p>Next, have a look at the constructor</p>
<pre><code class="lang-java">public CoffeeFilter(List&lt;Coffee&gt; originalCoffeeList, String filterText,
            CoffeeListAdapter adapter) {
        super();
        this.originalCoffeeList = originalCoffeeList;
        this.filterText = filterText;
        this.adapter = adapter;
    }</code></pre>
<p>and see if you can create an instance called <i>coffeeFilter</i> inside our <i>CoffeeFragment</i> without referring to the notes.</p>
<h1>Filtering our Favourites</h1>
<p>Once you have the filter set up, the next step is to call it&#39;s filter method correctly to filter out just the &#39;Favourite&#39; coffees and display them in our list. To achieve this you&#39;ll need to call the following code (can you work out where it should go inside our <i>CoffeeFragment</i>?)</p>
<pre><code class="lang-java">if (getActivity() instanceof Favourites) {
      coffeeFilter.setFilter(&quot;favourites&quot;); // Set the filter text field from &#39;all&#39; to &#39;favourites&#39;
      coffeeFilter.filter(null); // Filter the data, but don&#39;t use any prefix
      listAdapter.notifyDataSetChanged(); // Update the adapter
    }</code></pre>
<p>If you run the app again, and select the Favourites Button, you should now see just the &#39;Favourite&#39; coffees, like so:</p>
<p><img src="img/filterfavourites1.png" alt=""></p>
<p>Note that we didn&#39;t have to modify a single line of code in our <b>Favourites.java</b> Activity class.</p>
<p>There&#39;s still a few issues with our <b>Favourites</b> though, if you&#39;ve done some proper testing? And tried to delete multiple coffees via the context menu? Can you identify how to fix it?</p>
<p>Hint : You&#39;ll be focusing on the &#39;deleteCoffees() method and having to &#39;filter&#39; again. (Or you can always check the notes!)</p>
<p>The next thing to do is display a &quot;Random Suggestion&quot; Favourite coffee that the user could/should try, so using the following, have a go at that.</p>
<pre><code class="lang-java">public void setRandomCoffee() {

        ArrayList&lt;Coffee&gt; coffeeList = (ArrayList&lt;Coffee&gt;)activity.coffeeList.clone();
        Iterator&lt;Coffee&gt; itr = coffeeList.iterator();

        while(itr.hasNext()) {
            Coffee c = itr.next();
            if (!c.favourite)
                itr.remove();
        }
        if (activity instanceof Favourites)
            if( !coffeeList.isEmpty()) {
                Coffee randomCoffee = coffeeList.get(new Random()
                            .nextInt(coffeeList.size()));

              // Set the details on the layout
            }
            else {
                // Set default details
            }
    }</code></pre>
<p>Now, whenever the user loads up the favourites screen, they&#39;ll see their favourite coffees and a suggestion, like so :)</p>
<p><img src="img/random1.png" alt=""></p>
<p>Next we&#39;ll look at searching our coffees by name and/or type.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="05">
            <h1>Reusing Fragments - Searching Coffees</h1>
<p>We now have a Fragment that has filtering capabilities so we use these to search our list of coffees and refine the list based on either the coffees name, it&#39;s type, or both. To achieve this, we&#39;ll subclass our existing <b><i>CoffeeFragment</i></b> and create new class called <b><i>SearchFragment</i></b> and associate this Fragment with our <b>Search.java</b> Activity class.</p>
<h1>SearchFragment.java</h1>
<p>Have a quick look at the existing <b><i>SearchFragment</i></b> class (the one you created earlier in the lab):</p>
<pre><code class="lang-java">public class SearchFragment extends CoffeeFragment {

    public SearchFragment() {
        // Required empty public constructor
    }

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        TextView textView = new TextView(getActivity());
        textView.setText(R.string.hello_blank_fragment);
        return textView;
    }
}</code></pre>
<p>There&#39;s not much in there, so first replace it with the following :</p>
<pre><code class="lang-java">public class SearchFragment extends Fragment {

    public SearchFragment() {
        // Required empty public constructor
    }

    public static SearchFragment newInstance() {
        SearchFragment fragment = new SearchFragment();
        return fragment;
    }

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);    
    }

    @Override
    public void onAttach(Context c) { super.onAttach(c); }

    @Override
    public void onStart() { super.onStart(); }
}</code></pre>
<p>And the next thing we&#39;ll do is add some choices to the Spinner so the user can filter on a &#39;type&#39;.</p>
<p>We&#39;ll use an Adapter to populate the Spinner data so have a go at completing the following:</p>
<p>First, create the Resource Array</p>
<pre><code class="lang-xml">&lt;string-array name=&quot;coffeeTypes&quot;&gt;
        &lt;item&gt;All Types&lt;/item&gt;
        &lt;item&gt;Favourites&lt;/item&gt;
        &lt;item&gt;\&gt; 3\* Rating&lt;/item&gt;
    &lt;/string-array&gt;</code></pre>
<p>then the Adapter</p>
<pre><code class="lang-java">    ArrayAdapter&lt;CharSequence&gt; spinnerAdapter = ArrayAdapter
                .createFromResource(/*activity reference*/, /*the options to display*/,
                        android.R.layout.simple_spinner_item);

    spinnerAdapter
        .setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</code></pre>
<p>Next, bind to the Spinner widget of the layout</p>
<pre><code class="lang-java">    Spinner spinner = /*Bind to the spinner widget R.id.searchCoffeeTypeSpinner*/;</code></pre>
<p>and finally, set the Spinners adapter to the adapter you&#39;ve set up (<i>spinnerAdapter</i>).</p>
<p>If you run your app again, you would expect to see the Spinner showing data - but it does not. Can you work out what the issue is? (HINT: Have a look at the <b>Search.java</b> Activity class and the type of Fragment being loaded)</p>
<p>If you&#39;ve spotted what needed to be changed, run the app one more time and you should now be seeing something like this when you click on the Spinner.</p>
<p><img src="img/spinner1.png" alt=""></p>
<p>and</p>
<p><img src="img/spinner2.png" alt=""></p>
<p>The last step is to add the listeners for the <b><i>Spinner</i></b> and <b><i>SearchView</i></b> widgets to filter the list on the users selections.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="06">
            <h1>Reusing Fragments - Adding Event Handlers</h1>
<p>At the moment, if the user types in some text or selects an option from the Spinner on the Search screen, nothings happens as there&#39;s no code attached to these types of events. This step involves implementing the necessary interfaces to complete the lab.</p>
<p>If you haven&#39;t been doing so already, you should definitely make use of the Android Studio features to speed up this process, so all we will be left with is writing the specific code for what we want to happen.</p>
<h1>Handling the Spinner with the <u>OnItemSelectedListener</u> interface</h1>
<p>First of all, ensure your <b>SearchFragment</b> implements the correct interface</p>
<pre><code class="lang-java">implements AdapterView.OnItemSelectedListener</code></pre>
<p>and use Android Studio to implement the interface methods like so</p>
<p><img src="img/lab0409.png" alt=""></p>
<p>and you get the following:</p>
<pre><code class="lang-java">  @Override
    public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) {

    }

    @Override
    public void onNothingSelected(AdapterView&lt;?&gt; parent) {

    }</code></pre>
<p>We only need to complete the <i>onItemSelected</i> method to filter our list when the user selects a particular &#39;type&#39; of coffee, as follows:</p>
<p>Introduce a new global String variable &#39;selected&#39; then</p>
<p>Introduce this helper method</p>
<pre><code class="lang-java">private void checkSelected(String selected)
    {
        if (selected != null) {
            if (selected.equals(&quot;All Types&quot;)) {
                coffeeFilter.setFilter(&quot;all&quot;);
            } else if (selected.equals(&quot;Favourites&quot;)) {
                coffeeFilter.setFilter(&quot;favourites&quot;);
            }

            String filterText = ((SearchView)activity
                    .findViewById(R.id.searchView)).getQuery().toString();

            if(filterText.length() &gt; 0)
                coffeeFilter.filter(filterText);
            else
                coffeeFilter.filter(&quot;&quot;);
        }
    }</code></pre>
<p>and finally, inside &#39;onItemSelected&#39;</p>
<pre><code class="lang-java">  selected = parent.getItemAtPosition(position).toString();
  checkSelected(selected);</code></pre>
<p>Once again, be clear about what is going here.</p>
<p>We also need to override our &#39;deleteCoffees()&#39; method in the super class to ensure our context menu continues to function as expected, so revisit &#39;CoffeeFragment&#39; and change the access modifier of the method to public and then introduce the following method into your &#39;SearchFragment&#39;</p>
<pre><code class="lang-java">@Override
    public void deleteCoffees(ActionMode actionMode) {
        super.deleteCoffees(actionMode);
        checkSelected(selected);
    }</code></pre>
<p>The last thing to do is set the spinners listener, so have a go at this method call.</p>
<p>Run your app again to confirm everything is still working as expected.</p>
<h1>Handling the SearchView with <b><i>OnQueryTextListener</i></b></h1>
<p>Similar to handling the <b><i>Spinner</i></b> try and use the Android Studio features to implement the <b><i>OnQueryTextListener</i></b> interface. If you&#39;ve done this correctly you&#39;ll have the following method stubs:</p>
<pre><code class="lang-java">@Override
            public boolean onQueryTextSubmit(String query) {

                return false;
            }

            @Override
            public boolean onQueryTextChange(String newText) {

                return false;
            }</code></pre>
<p>And there&#39;s actually very little code necessary to implement this feature, so see if you can complete this final step without referring to the lecture material.</p>
<p>HINT: the <i>filter</i> method of our coffee filter takes a String to filter on and you need to add the relevant listener to the <b><i>SearchView</i></b>.</p>
<p>Once you have that up and running you should be seeing something like this during filtering:</p>
<p><img src="img/filter1.png" alt=""></p>
<p><img src="img/filter2.png" alt=""></p>
<p><img src="img/filter3.png" alt=""></p>

          </div>
        
          <div class="ui tab segment lab" data-tab="07">
            <h1>The Application Object</h1>
<p>In order to keep our application design coherent, we now bring in an &#39;Application&#39; object.</p>
<p>Create a new package called &#39;ie.cm.main&#39; and incorporate this class here:</p>
<pre><code class="lang-java">package ie.cm.main;

import ie.cm.models.Coffee;
import java.util.ArrayList;
import java.util.List;
import android.app.Application;
import android.util.Log;

public class CoffeeMateApp extends Application
{
  public List &lt;Coffee&gt;  coffeeList = new ArrayList&lt;Coffee&gt;();

  @Override
  public void onCreate()
  {
    super.onCreate();
    Log.v(&quot;coffeemate&quot;, &quot;CoffeeMate App Started&quot;);
  }
}</code></pre>
<p>Application objects need to be referenced in the AndroidManifest.xml - at the very top as &#39;andorid:name&#39;</p>
<pre><code class="lang-xml">    &lt;application
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:supportsRtl=&quot;true&quot;
        android:theme=&quot;@style/AppTheme&quot;
        android:name=&quot;ie.cm.main.CoffeeMateApp&quot;&gt;</code></pre>
<p>Make sure the &#39;CoffeeMate App Started&#39; appears in the logs to verify that it has actually been engaged correctly, when you launch the app.</p>
<p>As we now want our Application Object to manage or list of coffees, we need to replace all references of the list from Base with a reference to our Application Object list.</p>
<p>The Base class will now look something like this</p>
<pre><code class="lang-java">
...

public class Base extends Activity {

  public    CoffeeMateApp  app;
  protected Bundle         activityInfo;
  public    Fragment       coffeeFragment;

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    app = (CoffeeMateApp) getApplication();
  }

...</code></pre>
<p>You can then access the list of coffees via the Base class &#39;app&#39; reference like so...</p>
<p>Our refactored &#39;Add&#39;</p>
<pre><code class="lang-java">
app.coffeeList.add(c);</code></pre>
<p>See if you can refactor the rest of the affected classes.....</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Solution">
            <h1>Solution</h1>
<p>This is a solution to the lab:</p>
<ul>
<li><a href="archives/CoffeeMate.3.0.Solution.zip">CoffeeMate.3.0.Solution</a> including some bug fixes!</li>
</ul>
<p>In this lab you have experimented with Custom Adapters, Fragments and Filters, and the Application Object:</p>
<ul>
<li>Now go have a coffee :-)</li>
</ul>

          </div>
        
      </div>
    </div>
  </div>



  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> 
      </div>
    </div>
  </div>

  </body>

</html>