


  {
  
  
    "properties" : {},
  
  "type" : "lab",
  "title" : "Lab-04",
  "img" : "img/main.png",
  "videoid" : "none",
  "objectives" : "<p>This lab continues our Case Study <b>CoffeeMate</b> but with a major refactoring of the UI (using a Navigation Drawer) and a more detailed look at the use of Fragments in an Android App.</p>",
  "folder" : "book-coffeemate-lab-04",
  "link" : "index.html",
  "los": [
   ]
,
  "chapters" : [
  
    {
    "title": "# Objectives",
    "shortTitle": "Lab-04",
    "contentMd" : "# Objectives\n\nThis lab continues our Case Study <b>CoffeeMate</b> but with a major refactoring of the UI (using a Navigation Drawer) and a more detailed look at the use of Fragments in an Android App.\n"
    },
  
    {
    "title": "# Setup - Starter Code & Initial Resources",
    "shortTitle": "01",
    "contentMd" : "# Setup - Starter Code & Initial Resources\n\nAs this version of our case study will involve a major refactoring of the UI, we'll first create a new project **CoffeeMate.4.0** and choose the **Navigation Drawer** as the initial Activity type, like so:\n\n![Figure 1: Start a new Android Studio project](img/firstrun.png)\nPress \"Next\" (or click the option) and then select your Activity type, for this app we'll choose a **Navigation Drawer Activity**.\n\n![Figure 2: Choose Your Project](img/new01.png)\nSelect the Platform you want your app to run on - we'll just stick with Phone & Tablet here again\n\n![Figure 3: Configure Your Project](img/new02.png)\nChange default project name to **CoffeeMate.1.0**, change the default package name to **ie.cm** (or provide a company domain) and select a project location and a language (here, Java). Select an appropriate Minimum SDK (API 28 in the screenshot)\n\nAfter you press \"Finish\", you should now have something similar to the following:\n![Figure 4: Project open in Layout View](img/new03.png)\nand\n![Figure 5: Project open in Design View](img/new04.png)\nIf you don't see both layouts you can switch to 'Design + Blueprint' View as in previous labs.\n\nHave a quick look through what Android Studio has supplied as a starter Nav Drawer App - there's quite a lot in there, so hopefully, if you've had a chance to run through the related lecture slides, you can replace that starter project with this one and continue on.\n\nIt's strongly recommended that you download the starter code for this lab here - [CoffeeMate.4.0.Starter](archives/CoffeeMate.4.0.Starter.zip). It contains some required refactoring and all the resources you'll need to complete this lab along with some of the code and features already completed. But you're more than welcome to try and integrate this into your own previous version !!\n\nOnce you import the <b>CoffeeMate 4.0 Starter</b> Project it should looks as follows:\n\n![](img/starterproject1.png)\n\nTake some time to familiarise yourself with the new classes in your project and explore the resources that you will be referring to throughout the lab, especially the layouts in both 'Graphical Layout' view and 'XML' view for the <b>Navigation Drawer</b> (and it's associated resources and menus). It's also probably a good idea to run the App at this stage too, so you can set up your AVD (if you haven't done so already) and confirm that the starter app is configured properly and running as expected.\n\nIn this lab, you are required to do the following:\n\n- Add a Splash Screen (to make the app a bit more 'appealing')\n\n- Carry out a complete refactoring of the project to\n    - update existing Fragments for usage with a Navigation Drawer\n    - implement new Fragments to add in the necessary extra functionality\n    - remove any residual classes and resources no longer needed\n\nThe following steps will guide you through these requirements, so we'll start with Splash Screen.\n"
    },
  
    {
    "title": "# Adding a Splash Screen",
    "shortTitle": "02",
    "contentMd" : "# Adding a Splash Screen\n\nFirst of all, confirm that when you run the starter code you get the following:\n\n![](img/startscreen1.png)\n\nand, selecting the menu, this\n\n![](img/starterscreen2.png)\n\nbut we want this to load first\n\n![](img/startersplash.png)\n\nMost of the code we need to achieve this is already present, so first, open your **AndroidManifest.xml** and replace your ***launcher*** activity with the following\n\n~~~xml\n<activity\n      android:name=\"ie.cm.activities.Splash\"\n      android:configChanges=\"orientation|keyboardHidden\"\n      android:screenOrientation=\"portrait\"\n      android:theme=\"@android:style/Theme.NoTitleBar\" >\n        <intent-filter>\n            <action android:name=\"android.intent.action.MAIN\" />\n            <category android:name=\"android.intent.category.LAUNCHER\" />\n        </intent-filter>\n</activity>\n~~~\nand add this\n\n~~~xml\n<activity\n    android:name=\".activities.Home\"\n    android:theme=\"@style/AppTheme.NoActionBar\">\n</activity>\n~~~\n\nRun your app again and you should see\n\n![](img/startersplash.png)\n\nBefore you move on to the next step, it's probably worth testing the app to see what works and what doesn't. You'll notice the ***Favourites*** don't load properly\n\n![](img/starterscreen3.png)\n\nand if we delete all the coffees we don't see the \"Empty Coffees Message\". We don't even have our *random coffee* anymore (which we'll fix later), but let's fix the rest now.\n\n\nFirst, add the following to your CoffeeFragment\n\n~~~java\npublic boolean favourites = false;\n~~~\n\nThen, inside your **Home** activity, in ***onNavigationItemSelected()*** add\n\n~~~java\n((CoffeeFragment)fragment).favourites = false;\n~~~\n\nto the *R.id.nav_home* option\n\nand add\n\n~~~java\n((CoffeeFragment)fragment).favourites = true;\n~~~\n\nto the *R.id.nav_favourites* option immediately after the fragment is instantiated,\n\nand replace\n\n~~~java\n if (getActivity() instanceof Favourites) {...}\n~~~\n\nwith\n\n~~~java\n if (favourites) {...}\n~~~\n\nback in your **CoffeeFragment**. Be sure you understand why this change needs to be made.\n\nTest again for confirmation.\n\nNext, to fix the missing \"Empty Coffees Message\" add the following to your **onCreateView()** in CoffeeFragment\n\n~~~java\nlistView.setEmptyView(v.findViewById(R.id.emptyList));\n~~~\n\nTest again, to make sure the user gets the message when they have no coffees, like so\n\n![](img/nocoffee.png)\n\nYou can also remove any references to **checkEmptyList()** for completeness.\n\nIf you've extensively tested (which you should) you may find that multiple deleting your ***Favourite Coffees*** doesn't work as expected - you still see you coffees in the favourites list, even though they've been deleted. Revisit your code to see if you can fix this?\n\nHINT : check where you look for 'favourites' and you've already made a similar change for loading your favourites (as above).\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Add' Option (Part 1)",
    "shortTitle": "03",
    "contentMd" : "# App Refactoring - Our 'Add' Option (Part 1)\n\nOnce you've properly tested your latest version of CoffeeMate, you'll see that we only have The 'Home' & 'View Favourites' implemented. The next few steps will take you through building a new Fragment <b>AddFragment</b> and reusing a lot of the 'Add' activity code and resources.\n\nFirst, go ahead and create a new **(Blank)** Fragment called <b>AddFragment</b> in the <i>fragments</i> package with the following options :\n\n ![](img/addfragment.png)\n\nYou'll get a substantial amount of 'boilerplate' code, which we don't need for this project, so before continuing, ensure your new **AddFragment** initially looks like this\n\n~~~java\npublic class AddFragment extends Fragment {\n\n    public AddFragment() {\n        // Required empty public constructor\n    }\n\n    public static AddFragment newInstance() {\n        AddFragment fragment = new AddFragment();\n\n        return fragment;\n    }\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        return inflater.inflate(R.layout.fragment_add, container, false);\n    }\n}\n~~~\n\nThe next step is to replace the default fragment layout with our existing 'Add' activity layout so once you're done, you should have a layout like this for 'fragment_add' - ***make sure you convert the FrameLayout to ConstraintLayout before you paste in your xml***\n\n ![](img/addlayout.png)\n\n Here's the xml if you're stuck for time.\n\n ~~~xml\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/addLayout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".fragments.AddFragment\">\n\n    <TextView\n        android:id=\"@+id/addfooter\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"36dp\"\n        android:background=\"@color/colorPrimary\"\n        android:paddingTop=\"5dp\"\n        android:text=\"@string/appWebsite\"\n        android:textAlignment=\"center\"\n        android:textColor=\"@color/colorFontWhite\"\n        android:textSize=\"16sp\"\n        android:textStyle=\"bold\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.523\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"1.0\" />\n\n    <TextView\n        android:id=\"@+id/addPriceTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:layout_marginBottom=\"8dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"36dp\"\n        android:layout_marginTop=\"8dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeePriceLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toStartOf=\"@+id/editPriceET\"\n        app:layout_constraintHorizontal_bias=\"0.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.285\" />\n\n    <TextView\n        android:id=\"@+id/addShopTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:layout_marginBottom=\"8dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"36dp\"\n        android:layout_marginTop=\"8dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeeShopLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toStartOf=\"@+id/addShopET\"\n        app:layout_constraintHorizontal_bias=\"0.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.157\" />\n\n    <TextView\n        android:id=\"@+id/addNameTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"36dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeeNameLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/addShopTV\"\n        app:layout_constraintEnd_toStartOf=\"@+id/addNameET\"\n        app:layout_constraintHorizontal_bias=\"0.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.694\" />\n\n    <EditText\n        android:id=\"@+id/addNameET\"\n        android:layout_width=\"189dp\"\n        android:layout_height=\"44dp\"\n        android:layout_marginEnd=\"40dp\"\n        android:layout_marginStart=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Enter Coffee Name\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.447\"\n        app:layout_constraintStart_toEndOf=\"@+id/editNameTV\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.053\" />\n\n    <EditText\n        android:id=\"@+id/editPriceET\"\n        android:layout_width=\"131dp\"\n        android:layout_height=\"42dp\"\n        android:layout_marginEnd=\"100dp\"\n        android:layout_marginStart=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Enter Price\"\n        android:inputType=\"numberDecimal\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.447\"\n        app:layout_constraintStart_toEndOf=\"@+id/editPriceTV\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.292\" />\n\n    <EditText\n        android:id=\"@+id/addShopET\"\n        android:layout_width=\"189dp\"\n        android:layout_height=\"45dp\"\n        android:layout_marginEnd=\"40dp\"\n        android:layout_marginStart=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Enter Shop\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"1.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.169\" />\n\n    <RatingBar\n        android:id=\"@+id/addRatingBar\"\n        android:layout_width=\"242dp\"\n        android:layout_height=\"52dp\"\n        android:layout_marginTop=\"48dp\"\n        android:rating=\"1\"\n        android:stepSize=\"0.5\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/editPriceET\"\n        app:layout_constraintVertical_bias=\"0.213\" />\n\n    <Button\n        android:id=\"@+id/addCoffeeBtn\"\n        android:layout_width=\"79dp\"\n        android:layout_height=\"84dp\"\n        android:layout_marginTop=\"68dp\"\n        android:background=\"@color/colorFontOffWhite\"\n        android:drawableTop=\"@drawable/blue_add_48\"\n        android:onClick=\"addCoffee\"\n        android:text=\"@string/addCoffeeBtnLbl\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.501\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/addRatingBar\"\n        app:layout_constraintVertical_bias=\"0.714\" />\n\n</android.support.constraint.ConstraintLayout>\n ~~~\n\n We can now go ahead and implement the necessary code to add this fragment to the 'Home Screen'. We won't implement the actual logic until the next step, we'll just get the 'Add' screen loading, so navigate to your **Home** activity class and see can you get the add feature to load the relevant screen, like so\n\n ![](img/coffeecheckin.png)\n\n Note : if you get an import error on your <b>AddFragment</b> just ensure you have\n\n ~~~java\n import android.support.v4.app.Fragment;\n ~~~\n\ninstead of\n\n~~~java\nimport android.app.Fragment;\n~~~\n\n in your import statements (as this may throw up another error later on).\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Add' Option (Part 2)",
    "shortTitle": "04",
    "contentMd" : "# App Refactoring - Our 'Add' Option (Part 2)\nHere's the code you should have implemented (or something similar) to get the 'Add' screen loading\n\n~~~java\n    this.setTitle(R.string.addACoffeeLbl);\n    fragment = AddFragment.newInstance();\n    ft.replace(R.id.homeFrame, fragment);\n    ft.addToBackStack(null);\n    ft.commit();\n~~~\n\n and when you run the app you get the following\n\n ![](img/coffeecheckin.png)\n\n\nNow we can implement the logic behind the View to add a new coffee to our list of coffees.\n\nWe already have all the code we need in our 'Add' activity so go ahead and see can you complete this step without referring to the supporting lecture material.\n\nNow you'll probably get the following error\n\n![](img/error1.png)\n\nand it's related to the fact that our button is now part of a fragment and not an activity. A simple fix is to add an anonymous listener to our button (like we covered in the lectures) so try and have a go at that now.\n\nAlso, don't forget to remove the 'Add' activity (and associated layout) from the project once it's working, as we don't need them anymore.\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Search' Option (Part 1)",
    "shortTitle": "05",
    "contentMd" : "# App Refactoring - Our 'Search' Option (Part 1)\nWe'll take a similar approach with this feature as we did with the add feature - we'll get the navigation and screen up and running first, and then implement the logic.\n\nIn the previous version of CoffeeMate (Version 3.0) our 'Search' feature was implemented via a separate layout in a Search activity and we extended our <b>CoffeeFragment</b> to customise our Search (in a <b>SearchFragment</b>). To maintain our current <b><i>navigation design pattern</i></b> we should really remove our existing 'Search' activity and manage everything in our SearchFragment - so that's what we'll do.\n\nFirst, we need a new layout for our Search, so either copy/paste one of the existing fragment layouts, or go ahead and create a new one (I actually just renamed the <i>search</i> layout and went from there).\n\nWe already have most of the layout we need in the 'Search' xml file so see can you put together a layout similar to the following:\n\n**Take note of the widget names & types**\n\n![](img/searchlayout.png)\n\nIf it all gets a bit much for you :) here's the complete xml code but it's really worth having a go yourself first, as it will help you develop your layout design skills.\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n   xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n   xmlns:tools=\"http://schemas.android.com/tools\"\n   android:layout_width=\"match_parent\"\n   android:layout_height=\"match_parent\"\n   tools:context=\".fragments.SearchFragment\">\n\n   <TextView\n       android:id=\"@+id/searchBarTV\"\n       android:layout_width=\"0dp\"\n       android:layout_height=\"21dp\"\n       android:background=\"@color/colorPrimary\"\n       android:text=\"@string/searchCoffeesLbl\"\n       android:textAlignment=\"center\"\n       android:textColor=\"@color/colorFontWhite\"\n       android:textSize=\"16sp\"\n       app:layout_constraintBottom_toTopOf=\"@+id/footer\"\n       app:layout_constraintEnd_toEndOf=\"parent\"\n       app:layout_constraintHorizontal_bias=\"0.0\"\n       app:layout_constraintStart_toStartOf=\"parent\"\n       app:layout_constraintTop_toBottomOf=\"@+id/searchSpinner\"\n       app:layout_constraintVertical_bias=\"0.0\" />\n\n   <TextView\n       android:id=\"@+id/footer\"\n       android:layout_width=\"0dp\"\n       android:layout_height=\"36dp\"\n       android:background=\"@color/colorPrimary\"\n       android:paddingTop=\"5dp\"\n       android:text=\"@string/appWebsite\"\n       android:textAlignment=\"center\"\n       android:textColor=\"@color/colorFontWhite\"\n       android:textSize=\"16sp\"\n       android:textStyle=\"bold\"\n       app:layout_constraintBottom_toBottomOf=\"parent\"\n       app:layout_constraintEnd_toEndOf=\"parent\"\n       app:layout_constraintHorizontal_bias=\"0.0\"\n       app:layout_constraintStart_toStartOf=\"parent\" />\n\n   <TextView\n       android:id=\"@+id/emptyList\"\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:layout_gravity=\"top|center_horizontal\"\n       android:layout_marginBottom=\"8dp\"\n       android:layout_marginEnd=\"8dp\"\n       android:layout_marginStart=\"8dp\"\n       android:layout_marginTop=\"32dp\"\n       android:text=\"@string/emptyMessageLbl\"\n       android:textColor=\"@color/colorFontBlack\"\n       android:textSize=\"14sp\"\n       android:textStyle=\"bold\"\n       app:layout_constraintBottom_toBottomOf=\"@+id/searchList\"\n       app:layout_constraintEnd_toEndOf=\"parent\"\n       app:layout_constraintStart_toStartOf=\"parent\"\n       app:layout_constraintTop_toTopOf=\"@+id/searchList\"\n       app:layout_constraintVertical_bias=\"0.102\" />\n\n\n   <Spinner\n       android:id=\"@+id/searchSpinner\"\n       android:layout_width=\"0dp\"\n       android:layout_height=\"50dp\"\n       android:layout_marginBottom=\"8dp\"\n       android:layout_marginEnd=\"8dp\"\n       android:layout_marginStart=\"8dp\"\n       android:layout_marginTop=\"8dp\"\n       app:layout_constraintBottom_toTopOf=\"@+id/footer\"\n       app:layout_constraintEnd_toEndOf=\"parent\"\n       app:layout_constraintStart_toStartOf=\"parent\"\n       app:layout_constraintTop_toTopOf=\"parent\"\n       app:layout_constraintVertical_bias=\"0.112\" />\n\n   <SearchView\n       android:id=\"@+id/searchView\"\n       android:layout_width=\"0dp\"\n       android:layout_height=\"46dp\"\n       android:layout_marginBottom=\"8dp\"\n       android:layout_marginEnd=\"8dp\"\n       android:layout_marginStart=\"8dp\"\n       android:layout_marginTop=\"8dp\"\n       android:background=\"#fff\"\n       android:elevation=\"2dp\"\n       android:visibility=\"visible\"\n       app:layout_constraintBottom_toBottomOf=\"@+id/searchSpinner\"\n       app:layout_constraintEnd_toEndOf=\"parent\"\n       app:layout_constraintStart_toStartOf=\"parent\"\n       app:layout_constraintTop_toTopOf=\"parent\"\n       app:layout_constraintVertical_bias=\"0.14\" />\n\n   <ListView\n       android:id=\"@+id/searchList\"\n       android:layout_width=\"0dp\"\n       android:layout_height=\"0dp\"\n       android:layout_marginEnd=\"8dp\"\n       android:layout_marginStart=\"8dp\"\n       android:layout_marginTop=\"8dp\"\n       app:layout_constraintBottom_toTopOf=\"@+id/footer\"\n       app:layout_constraintEnd_toEndOf=\"parent\"\n       app:layout_constraintStart_toStartOf=\"parent\"\n       app:layout_constraintTop_toBottomOf=\"@+id/searchBarTV\"/>\n\n</android.support.constraint.ConstraintLayout>\n~~~\n\nThe next thing we need to do is associate this layout with our existing <b>SearchFragment</b> and bind to the widgets such as the Spinner, the EditText etc.\n\nEven though our SearchFragment extends from CoffeeFragment, we can't use the standard CoffeeFragment layout so the first thing we need to do is bring in (and override) the <i>onCreateView()</i> method for our SearchFragment.\n\nIntroduce the following to your **SearchFragment** fragment\n\n~~~java\n@Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n\n        View v = inflater.inflate(R.layout.fragment_search, container, false);\n        listView = v.findViewById(R.id.searchList); //Bind to the list on our Search layout\n\n        return v;\n    }\n\n~~~\n\nCan you explain why we need to bind to the 'coffeeList' ListView widget? (comment out the line of code and run the app once you've completed the 'wiring up', and see does that give you any clues?).\n\nYou will also need to move\n\n~~~java\nlistAdapter = new CoffeeListAdapter(activity, this, activity.app.coffeeList);\ncoffeeFilter = new CoffeeFilter(activity.app.coffeeList,\"all\",listAdapter);\n~~~\n\nfrom your **CoffeeFragment**'s ***onCreateView()*** to ***onCreate()*** to avoid a NullPointerException.\n\nNow, 'wire up' a new instance of this fragment to the Search option on the Navigation Drawer, similar to how we did the 'Add' and 'View Favourites'.\n\nIf you run the app at this stage (which you should) you'll probably get a NullPointerException error anyway, so be clear why we need to move some existing code from <b>onCreate()</b> to <b>onCreateView()</b>, and carry out some refactoring, like so\n\n~~~java\n@Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n\n        View v = inflater.inflate(R.layout.fragment_search, container, false);\n        listView = v.findViewById(R.id.searchList); //Bind to the list on our Search layout\n        setListView(v);\n        ArrayAdapter<CharSequence> spinnerAdapter = ArrayAdapter\n                .createFromResource(getActivity(), R.array.coffeeTypes,\n                        android.R.layout.simple_spinner_item);\n\n        spinnerAdapter\n                .setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\n\n        Spinner spinner = v.findViewById(R.id.searchSpinner);\n        spinner.setAdapter(spinnerAdapter);\n        spinner.setOnItemSelectedListener(this);\n\n        searchView = v.findViewById(R.id.searchView);\n        searchView.setQueryHint(\"Search your Coffees Here\");\n\n        searchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {\n\n            @Override\n            public boolean onQueryTextSubmit(String query) {\n                coffeeFilter.filter(query);\n                return false;\n            }\n\n            @Override\n            public boolean onQueryTextChange(String newText) {\n                coffeeFilter.filter(newText);\n                return false;\n            }\n        });\n\n        return v;\n    }\n~~~\n\nNotice there's a new <b>setListView(v)</b> method. This has been introduced to reduce some code redundancy, so make sure it's implemented, and correctly called, in the **CoffeeFragment** class. Here's the code you need for this method (and should be called in the CoffeeFragment onCreateView() method, replacing the same calls)\n\n~~~java\npublic void setListView(View view)\n   {\n       listView.setAdapter (listAdapter);\n       listView.setOnItemClickListener(this);\n       listView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);\n       listView.setMultiChoiceModeListener(this);\n       listView.setEmptyView(view.findViewById(R.id.emptyList));\n   }\n~~~\n\nOnce you've made the necessary changes, run the app again and confirm you get the following after you choose the 'Search' option:\n\n![](img/search1.png)\n\nYou'll notice that the spinner and filter are working 'out of the box'- another example of the benefits of using (and reusing) Fragments.\n\nWhen you're done, you should be able to Search & Filter as normal (as with the previous version) only this time it's all nice and contained in a Fragment, like so:\n\n![](img/search2.png)\n\nand\n\n![](img/search3.png)\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Edit' Option (Part 1)",
    "shortTitle": "06",
    "contentMd" : "# App Refactoring - Our 'Edit' Option (Part 1)\n\nThis step is similar to our `AddFragment` implementation but there's a bit more complexity involved as we need to\n\n* Create a new Fragment `EditFragment` (similar to Add)\n* Recycle the 'Edit' Layout for use with our new Fragment (similar to Add)\n* Pass the relevant/selected Coffee Data from the 'Coffee List' (managed within the `CoffeeFragment`) to the `EditFragment`\n\nAND\n\n* Implement a callback interface from our Fragment to our Activity to handle the 'favourites star' toggle and the update button.\n\n**Note:** We could simply have our `EditFragment` implement an onClick Listener, but this is an opportunity to demonstrate how to communicate between a Fragment and an Activity.\n\nSo first of all, go ahead and create the Fragment (and it's associated layout\\ but this time, make sure you choose to **Include interface Callbacks**, like so .\n\n![](img/editsetup.png)\n\nThen, modify the boilerplate code so that the **_newInstance\\(\\)_** method takes a `Bundle` object (called ***coffeeBundle***) as a parameter.\n\nNow, our current ***onItemClick()*** method inside our CoffeeFragment, looks like this\n\n~~~java\n@Override\n    public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {\n        Bundle activityInfo = new Bundle(); // Creates a new Bundle object\n        activityInfo.putString(\"coffeeId\", (String) view.getTag());\n        Intent goEdit = new Intent(getActivity(), Edit.class); // Creates a new Intent\n        /* Add the bundle to the intent here */\n        goEdit.putExtras(activityInfo);\n        getActivity().startActivity(goEdit); // Launch the Intent\n    }\n~~~\n\nso see if you can implement the necessary code to 'switch to' the EditFragment instead of launching the Edit activity (We'll revisit this code in Part 2 to complete the Edit feature).\n\n`Hint: have a look at your Home activity and how we manage our Fragments`\n\n---\n\nNext, you need to update your layout, so again, have a go at that, but to help you along here's the layout I copied from our 'edit.xml' and refactored to suit our needs.\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".fragments.EditFragment\">\n\n    <TextView\n        android:id=\"@+id/editBarTV\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"25dp\"\n        android:layout_marginTop=\"104dp\"\n        android:background=\"@color/colorPrimary\"\n        android:paddingBottom=\"2dp\"\n        android:text=\"@string/coffeeDetailsLbl\"\n        android:textAlignment=\"center\"\n        android:textColor=\"@color/colorFontWhite\"\n        android:textSize=\"18sp\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <TextView\n        android:id=\"@+id/editfooter\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"36dp\"\n        android:background=\"@color/colorPrimary\"\n        android:paddingTop=\"5dp\"\n        android:text=\"@string/appWebsite\"\n        android:textAlignment=\"center\"\n        android:textColor=\"@color/colorFontWhite\"\n        android:textSize=\"16sp\"\n        android:textStyle=\"bold\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.523\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"1.0\" />\n\n    <TextView\n        android:id=\"@+id/editPriceTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeePriceLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.056\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.613\" />\n\n    <TextView\n        android:id=\"@+id/editShopTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeeShopLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.056\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.472\" />\n\n    <TextView\n        android:id=\"@+id/editNameTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeeNameLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.056\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.344\" />\n\n    <EditText\n        android:id=\"@+id/editNameET\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginBottom=\"8dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Coffee Name\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.447\"\n        app:layout_constraintStart_toEndOf=\"@+id/editNameTV\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.307\" />\n\n    <EditText\n        android:id=\"@+id/editPriceET\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginBottom=\"8dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Price\"\n        android:inputType=\"numberDecimal\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.447\"\n        app:layout_constraintStart_toEndOf=\"@+id/editPriceTV\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.572\" />\n\n    <EditText\n        android:id=\"@+id/editShopET\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginStart=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Shop\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editPriceET\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.369\"\n        app:layout_constraintStart_toEndOf=\"@+id/editShopTV\"\n        app:layout_constraintTop_toBottomOf=\"@+id/editNameET\"\n        app:layout_constraintVertical_bias=\"0.444\" />\n\n    <RatingBar\n        android:id=\"@+id/editRatingBar\"\n        android:layout_width=\"242dp\"\n        android:layout_height=\"52dp\"\n        android:rating=\"1\"\n        android:stepSize=\"0.5\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/editPriceET\"\n        app:layout_constraintVertical_bias=\"0.116\" />\n\n    <Button\n        android:id=\"@+id/editCoffeeBtn\"\n        android:layout_width=\"79dp\"\n        android:layout_height=\"84dp\"\n        android:layout_marginBottom=\"8dp\"\n        android:background=\"@color/colorFontOffWhite\"\n        android:drawableTop=\"@drawable/blue_add_48\"\n        android:onClick=\"saveCoffee\"\n        android:text=\"@string/saveCoffeeBtn\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.501\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/addRatingBar\"\n        app:layout_constraintVertical_bias=\"0.466\" />\n\n    <TextView\n        android:id=\"@+id/editTitleTV\"\n        android:layout_width=\"254dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"16dp\"\n        android:text=\"Title\"\n        android:textSize=\"30sp\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.07\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <ImageView\n        android:id=\"@+id/editFavourite\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"16dp\"\n        android:onClick=\"toggle\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.929\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:srcCompat=\"@drawable/favourites_72\" />\n</android.support.constraint.ConstraintLayout>\n~~~\n\nRun you app and confirm you get a blank Edit Screen when you select a row in the coffee list, like so:\n\n![](img/editscreen.png)\n\nBut you get an error instead??\n\nCan you try a quick fix to get the app running?\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Edit' Option (Part 2)",
    "shortTitle": "07",
    "contentMd" : "# App Refactoring - Our 'Edit' Option (Part 2)\n\nThe problem with the previous step was the Main Activity (in out case 'Home' must implement the **OnFragmentInteractionListener** interface \\(for the callbacks\\) so you can carry out a quick fix like so\n\n![](img/edit1.png)\n\n![](img/edit2.png)\n\nchoosing to Implement method\n\n![](img/edit3.png)\n\nRun your app again just to make sure everything is working as expected. **OnFragmentInteractionListener **isn't really of any use at the moment, but we'll come back to that later**\n\n\nNow, This step involves recycling a lot of our existing code from our Add Activity but also implementing a callback interface, a lot of which is actually supplied for us via Android Studio when we create a Fragment.\n\nFirst of all, ensure your `CoffeeFragment`'s *onItemClick()* looks something like this\n\n~~~java\n@Override\n    public void onItemClick(AdapterView<?> adapterView, View view, int i, long l) {\n        Bundle activityInfo = new Bundle(); // Creates a new Bundle object\n        activityInfo.putString(\"coffeeId\", (String) view.getTag());\n\n        Fragment fragment = EditFragment.newInstance(activityInfo);\n        getActivity().setTitle(R.string.editCoffeeLbl);\n        getFragmentManager().beginTransaction()\n                .replace(R.id.homeFrame, fragment)\n                .addToBackStack(null)\n                .commit();\n    }\n~~~\n\nand your initial `EditFragment` looks something like this\n\n~~~java\npublic class EditFragment extends Fragment {\n    // TODO: Rename parameter arguments, choose names that match\n    // the fragment initialization parameters, e.g. ARG_ITEM_NUMBER\n    private static final String ARG_PARAM1 = \"param1\";\n    private static final String ARG_PARAM2 = \"param2\";\n\n    // TODO: Rename and change types of parameters\n    private String mParam1;\n    private String mParam2;\n\n    private OnFragmentInteractionListener mListener;\n\n    public EditFragment() {\n        // Required empty public constructor\n    }\n\n    public static EditFragment newInstance(Bundle coffeeBundle) {\n        EditFragment fragment = new EditFragment();\n        fragment.setArguments(coffeeBundle);\n        return fragment;\n    }\n\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        if (getArguments() != null) {\n            mParam1 = getArguments().getString(ARG_PARAM1);\n            mParam2 = getArguments().getString(ARG_PARAM2);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        return inflater.inflate(R.layout.fragment_edit, container, false);\n    }\n\n    // TODO: Rename method, update argument and hook method into UI event\n    public void onButtonPressed(Uri uri) {\n        if (mListener != null) {\n            mListener.onFragmentInteraction(uri);\n        }\n    }\n\n    @Override\n    public void onAttach(Context context) {\n        super.onAttach(context);\n        if (context instanceof OnFragmentInteractionListener) {\n            mListener = (OnFragmentInteractionListener) context;\n        } else {\n            throw new RuntimeException(context.toString()\n                    + \" must implement OnFragmentInteractionListener\");\n        }\n    }\n\n    @Override\n    public void onDetach() {\n        super.onDetach();\n        mListener = null;\n    }\n\n    /**\n     * This interface must be implemented by activities that contain this\n     * fragment to allow an interaction in this fragment to be communicated\n     * to the activity and potentially other fragments contained in that\n     * activity.\n     * <p>\n     * See the Android Training lesson <a href=\n     * \"http://developer.android.com/training/basics/fragments/communicating.html\"\n     * >Communicating with Other Fragments</a> for more information.\n     */\n    public interface OnFragmentInteractionListener {\n        // TODO: Update argument type and name\n        void onFragmentInteraction(Uri uri);\n    }\n}\n~~~\n\nNow, we need to first of all, be able to display our coffee data on our Edit screen, so see can you reuse what you already have in your existing activity and incorporate it in your new `EditFragment`. What you're looking for is something like this screen (if we selected 'Regular Joe' from our list)\n\n![](img/editscreen2.png)\n\nSo revisit how it's implemented in the `Edit` Activity and how you can leverage that to get it to work in the `EditFragment`.\n\n`Hint: You need to do something very similar to what you did with the AddFragment insofar as you need to refactor the onCreateView() method but also add the following to your onCreate() method, to retrieve the correct coffee data before you display it`\n\n~~~java\n@Override\npublic void onCreate(Bundle savedInstanceState)\n{    \n    super.onCreate(savedInstanceState);    \n        if(getArguments() != null)        \n            aCoffee = getCoffeeObject(getArguments().getInt(\"coffeeId\"));\n}\n~~~\n\nThe final step is to implement our listeners for the update button and the 'toggle'.\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Edit' Option (Part 3)",
    "shortTitle": "08",
    "contentMd" : "# App Refactoring - Our 'Edit' Option (Part 3)\n\nAs we're using (and replacing) Fragments instead of switching between Activities, we have two options when trying to implement event handling.  We can\n\n1. Implement the event handling and listeners 'in house' and manage everything inside the Fragment - but this can get a bit tricky when we want to handle more than one event (like our situation)\n\nor\n\n2. we implement a callback listener to the parent activity (in our case `Home`), which ties in with the particular navigation pattern we're trying to adhere to - so this is what we'll do.\n\nIf you recall, Android Studio generated a lot of boilerplate code for us, including some template callback listeners - which we needed to implement to get a version of our app running. We'll now revisit this code (and the whole `EditFragment`) and complete our ***Edit*** feature.\n\nFirst, familiarise yourself with the particular listener we need to implement\n\n~~~java\npublic interface OnFragmentInteractionListener\n{    \n// TODO: Update argument type and name    \nvoid onFragmentInteraction(Uri uri);\n}\n~~~\n\nand the default methods to 'hook up', attach/detach to the UI event\n\n~~~java\n// TODO: Rename method, update argument and hook method into UI event\n\npublic void onButtonPressed(Uri uri)\n{    \nif (mListener != null) {        \n    mListener.onFragmentInteraction(uri);    \n    }\n}\n\n@Override\npublic void onAttach(Context context)\n{    \n    super.onAttach(context);    \n        if (context instanceof OnFragmentInteractionListener) {        \n            mListener = (OnFragmentInteractionListener) context;    \n            }\n            else {        \n                    throw new RuntimeException(context.toString()                \n                            + \" must implement OnFragmentInteractionListener\");    \n            }\n}\n\n@Override\npublic void onDetach()\n{    \n    super.onDetach();    \n    mListener = null;\n}\n~~~\n\nNext, bring in the existing methods from the `Edit` activity ('toggle' and 'update') and fix any errors.\n\n`Note: Seeing as we need to bind to the widgets both for displaying and updating it's probably best to use class-wide widget variables (like we did for our 'Add') so before you proceed, make sure your onCreateView() and update() methods look something like this`\n\n~~~java\n@Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        View v = inflater.inflate(R.layout.fragment_edit, container, false);\n\n        ((TextView)v.findViewById(R.id.editTitleTV)).setText(aCoffee.coffeeName);\n\n        name = v.findViewById(R.id.editNameET);\n        shop = v.findViewById(R.id.editShopET);\n        price = v.findViewById(R.id.editPriceET);\n        ratingBar = v.findViewById(R.id.editRatingBar);\n        editFavourite = v.findViewById(R.id.editFavourite);\n\n        name.setText(aCoffee.coffeeName);\n        shop.setText(aCoffee.shop);\n        price.setText(\"\"+aCoffee.price);\n        ratingBar.setRating((float)aCoffee.rating);\n\n        if (aCoffee.favourite == true) {\n            editFavourite.setImageResource(R.drawable.favourites_72_on);\n            isFavourite = true;\n        } else {\n            editFavourite.setImageResource(R.drawable.favourites_72);\n            isFavourite = false;\n        }\n        return v;\n    }\n~~~\nand\n~~~java\npublic void update(View v) {    \n        if (mListener != null) {        \n                String coffeeName = name.getText().toString();        \n                String coffeeShop = shop.getText().toString();        \n                String coffeePriceStr = price.getText().toString();        \n                double ratingValue = ratingBar.getRating();        \n\n                double coffeePrice;        \n                        try {            \n                        coffeePrice = Double.parseDouble(coffeePriceStr);        \n                        } catch (NumberFormatException e)\n                        {            coffeePrice = 0.0;        }        \n\n                if ((coffeeName.length() > 0) && (coffeeShop.length() > 0) && (coffeePriceStr.length() > 0)) {            \n                        aCoffee.name = coffeeName;            \n                        aCoffee.shop = coffeeShop;            \n                        aCoffee.price = coffeePrice;            \n                        aCoffee.rating = ratingValue;           \n                     }        \n                } else            \n                Toast.makeText(getActivity(), \"You must Enter Something for Name and Shop\", Toast.LENGTH_SHORT).show();    \n                }\n        }\n~~~\n\nThe last thing we need to do is refactor our Listener interface to reflect the events we want to handle so replace the existing interface with this one\n\n~~~java\npublic interface OnFragmentInteractionListener {    \n    void toggle(View v);    \n    void saveCoffee(View v);\n}\n~~~\n\nAnd use the Android Studio Tools to implement these new methods back in our 'Home' activity (and fix any residual errors).\n\nHere's the implementation for the 'toggle' inside `Home`\n\n~~~java\n@Override\npublic void toggle(View v) {    \n    EditFragment editFrag = (EditFragment) getSupportFragmentManager().findFragmentById(R.id.homeFrame);    \n        if (editFrag != null) {        \n                editFrag.toggle(v);    \n        }\n    }\n~~~\n\nso have a go at implementing/completing the 'toggle' and the 'saveCoffee' methods.\n\n`Note : If you find that your Edit Layout doesn't render correctly, i.e. it gets 'pushed up', just add the following to the top of your 'Home.xml'`\n\n~~~xml\nandroid:fitsSystemWindows=\"true\"\n~~~\n"
    },
  
    {
    "title": "# App Refactoring - Our 'Edit' Option (Part 4)",
    "shortTitle": "09",
    "contentMd" : "# App Refactoring - Our 'Edit' Option (Part 4)\n\nNow, once you've tried to confirm that your update and toggle features are working as expected, you've probably noticed you have to manually navigate back to the previous screen when you click the update button.\n\nTo improve the user experience somewhat, we can ensure that the user is automatically returned to the previous screen after they've selected the update button - no matter which screen they were on. This can be achieved with the following code, so add this to your Fragment in the relevant place and run your app again and see what happens.\n\n~~~java\nif (getSupportFragmentManager().getBackStackEntryCount() > 0) {    \n                getFragmentManager().popBackStack();    \n                return;\n         }\n~~~\n\nAlso, to avoid the soft keyboard overlapping or obscuring our edittexts, place the following in the manifest file in the 'Home' activity tag\n\n~~~xml\nandroid:windowSoftInputMode=\"adjustPan|adjustResize\"\n~~~\n\n`Note : there were a few issues with the layout initially, so if your fragment_edit layout isn't as expected you can replace it with the following (which has a ConstraintLayout layout)``\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.constraint.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:id=\"@+id/addLayout\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".fragments.EditFragment\">\n\n    <TextView\n        android:id=\"@+id/editBarTV\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"25dp\"\n        android:layout_marginTop=\"104dp\"\n        android:background=\"@color/colorPrimary\"\n        android:paddingBottom=\"2dp\"\n        android:text=\"@string/coffeeDetailsLbl\"\n        android:textAlignment=\"center\"\n        android:textColor=\"@color/colorFontWhite\"\n        android:textSize=\"18sp\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <TextView\n        android:id=\"@+id/editfooter\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"36dp\"\n        android:background=\"@color/colorPrimary\"\n        android:paddingTop=\"5dp\"\n        android:text=\"@string/appWebsite\"\n        android:textAlignment=\"center\"\n        android:textColor=\"@color/colorFontWhite\"\n        android:textSize=\"16sp\"\n        android:textStyle=\"bold\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.523\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"1.0\" />\n\n    <TextView\n        android:id=\"@+id/editPriceTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeePriceLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.056\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.613\" />\n\n    <TextView\n        android:id=\"@+id/editShopTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeeShopLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.056\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.472\" />\n\n    <TextView\n        android:id=\"@+id/editNameTV\"\n        android:layout_width=\"99dp\"\n        android:layout_height=\"43dp\"\n        android:paddingTop=\"10dp\"\n        android:text=\"@string/coffeeNameLbl\"\n        android:textAlignment=\"textEnd\"\n        android:textColor=\"@color/colorFontBlack\"\n        android:textSize=\"18sp\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.056\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.344\" />\n\n    <EditText\n        android:id=\"@+id/editNameET\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginBottom=\"8dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Coffee Name\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.447\"\n        app:layout_constraintStart_toEndOf=\"@+id/editNameTV\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.307\" />\n\n    <EditText\n        android:id=\"@+id/editPriceET\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginBottom=\"8dp\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Price\"\n        android:inputType=\"numberDecimal\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.447\"\n        app:layout_constraintStart_toEndOf=\"@+id/editPriceTV\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.572\" />\n\n    <EditText\n        android:id=\"@+id/editShopET\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginStart=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Shop\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editPriceET\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.369\"\n        app:layout_constraintStart_toEndOf=\"@+id/editShopTV\"\n        app:layout_constraintTop_toBottomOf=\"@+id/editNameET\"\n        app:layout_constraintVertical_bias=\"0.444\" />\n\n    <RatingBar\n        android:id=\"@+id/editRatingBar\"\n        android:layout_width=\"242dp\"\n        android:layout_height=\"52dp\"\n        android:rating=\"1\"\n        android:stepSize=\"0.5\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/editPriceET\"\n        app:layout_constraintVertical_bias=\"0.116\" />\n\n    <Button\n        android:id=\"@+id/editCoffeeBtn\"\n        android:layout_width=\"79dp\"\n        android:layout_height=\"84dp\"\n        android:layout_marginBottom=\"8dp\"\n        android:background=\"@color/colorFontOffWhite\"\n        android:drawableTop=\"@drawable/blue_add_48\"\n        android:onClick=\"saveCoffee\"\n        android:text=\"@string/saveCoffeeBtn\"\n        app:layout_constraintBottom_toTopOf=\"@+id/editfooter\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.501\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/addRatingBar\"\n        app:layout_constraintVertical_bias=\"0.466\" />\n\n    <TextView\n        android:id=\"@+id/editTitleTV\"\n        android:layout_width=\"254dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"16dp\"\n        android:text=\"Title\"\n        android:textSize=\"30sp\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.07\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <ImageView\n        android:id=\"@+id/editFavourite\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginEnd=\"8dp\"\n        android:layout_marginStart=\"8dp\"\n        android:layout_marginTop=\"16dp\"\n        android:onClick=\"toggle\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintHorizontal_bias=\"0.929\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:srcCompat=\"@drawable/favourites_72\" />\n</android.support.constraint.ConstraintLayout>\n~~~\n\nThe final step in this lab is optional really, but does make our list look a little bit nicer :) \n"
    },
  
    {
    "title": "# App Refactoring - Replacing our Custom coffee_row with a 'Card'",
    "shortTitle": "10",
    "contentMd" : "# App Refactoring - Replacing our Custom coffee_row with a 'Card'\n\nIf you complete this step your final version of CoffeeMate.4.0 will look something like this\n\n![](img/customcardview.png)\n\nNotice the slight curves at the corners, and a bit of a shadow, all achieved by using a `CardView` Layout for displaying our coffees.\n\nThere's not too much involved in this, unless you want to try it all yourself (not using the xml supplied).\n\nFirst, add a new color\n\n~~~xml\n<color name=\"colorCardShadow\">#1616c8</color>\n~~~\n\nNext, create a new layout called `coffeecard.xml` and replace it with the following\n\n~~~xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<android.support.v7.widget.CardView xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:id=\"@+id/coffeecardview\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:elevation=\"50dp\"\n    android:outlineSpotShadowColor=\"@color/colorCardShadow\"\n    app:cardCornerRadius=\"5dp\"\n    app:cardElevation=\"24dp\">\n\n    <RelativeLayout\n        android:id=\"@+id/cardviewlayout\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:background=\"@drawable/background_activated\">\n\n        <ImageView\n            android:id=\"@+id/rowFavouriteImg\"\n            android:layout_width=\"48dp\"\n            android:layout_height=\"48dp\"\n            android:layout_alignParentLeft=\"true\"\n            android:layout_marginStart=\"8dp\"\n            android:layout_marginLeft=\"8dp\"\n            android:layout_marginTop=\"8dp\"\n            android:layout_marginEnd=\"8dp\"\n            android:layout_marginBottom=\"8dp\"\n            android:contentDescription=\"fav\"\n            android:gravity=\"center_vertical\"\n            android:src=\"@drawable/favourites_72\" />\n\n        <ImageView\n            android:id=\"@+id/rowDeleteImg\"\n            android:layout_width=\"48dp\"\n            android:layout_height=\"49dp\"\n            android:layout_alignParentTop=\"true\"\n            android:layout_alignParentRight=\"true\"\n            android:layout_marginStart=\"8dp\"\n            android:layout_marginTop=\"8dp\"\n            android:layout_marginEnd=\"8dp\"\n            android:layout_marginRight=\"5dp\"\n            android:contentDescription=\"fav\"\n            android:src=\"@android:drawable/ic_delete\" />\n\n        <TextView\n            android:id=\"@+id/rowCoffeeName\"\n            android:layout_width=\"130dp\"\n            android:layout_height=\"20dp\"\n            android:layout_alignTop=\"@+id/rowFavouriteImg\"\n            android:layout_alignParentStart=\"true\"\n            android:layout_marginStart=\"68dp\"\n            android:gravity=\"center_vertical\"\n            android:text=\"Coffee Name\"\n            android:textColor=\"@color/colorPrimary\"\n            android:textSize=\"14sp\"\n            android:textStyle=\"bold\" />\n\n        <TextView\n            android:id=\"@+id/rowCoffeeShop\"\n            android:layout_width=\"130dp\"\n            android:layout_height=\"16dp\"\n            android:layout_alignStart=\"@+id/rowCoffeeName\"\n            android:layout_alignBottom=\"@+id/rowFavouriteImg\"\n            android:gravity=\"center_vertical\"\n            android:text=\"Coffee Shop\"\n            android:textColor=\"@color/colorFontBlack\"\n            android:textSize=\"11sp\"\n            android:textStyle=\"bold\" />\n\n        <TextView\n            android:id=\"@+id/rowRating\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_alignBottom=\"@+id/rowFavouriteImg\"\n            android:layout_alignParentEnd=\"true\"\n            android:layout_marginEnd=\"71dp\"\n            android:gravity=\"center_vertical\"\n            android:text=\"5.0 *\"\n            android:textColor=\"@color/colorFontBlack\"\n            android:textSize=\"11sp\"\n            android:textStyle=\"bold\" />\n\n        <TextView\n            android:id=\"@+id/rowPrice\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_alignStart=\"@+id/rowRating\"\n            android:layout_alignTop=\"@+id/rowCoffeeName\"\n            android:gravity=\"center_vertical\"\n            android:text=\"€3.99\"\n            android:textColor=\"@color/colorPrimary\"\n            android:textSize=\"14sp\"\n            android:textStyle=\"bold\" />\n    </RelativeLayout>\n\n</android.support.v7.widget.CardView>\n~~~\n\nThen, update your `CoffeeItem` to use this layout instead of the current 'coffee_row.xml'.\n\nAnd that's it :)\n\nWell Done!\n\nNOTE : The `Help` Screen and 'Random Coffee' feature have been removed because\n\n- The `Help`, actually wasn't much, help that is.... and\n- The `Random Coffee` feature would require a whole new Fragment and Layout and it was decided that this wouldn't a huge amount extra to the lab, for the time it would take to implement it.\n"
    },
  
    {
    "title": "#Solution",
    "shortTitle": "Solution",
    "contentMd" : "#Solution\n\nAs an exercise, try and refactor the Help Option to use a fragment instead of an activity, to adhere to the UI Navigation Design Pattern we're using.\n\nThis is a solution to the lab:\n\n* [CoffeeMate.4.0.Solution](archives/CoffeeMate.4.0.Solution.zip)\n"
    }
  
  ]
  }

